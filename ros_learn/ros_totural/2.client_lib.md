## 1 using colcon to build packages

ğŸ§© ä¸€ã€Underlay ä¸ Overlay æ¦‚å¿µ
* **Underlay**ï¼šä½ å·²ç»å®‰è£…å¥½çš„ ROS 2 ç¯å¢ƒï¼ˆæ¯”å¦‚ `/opt/ros/galactic`ï¼‰ã€‚
  å®ƒæä¾›åŸºç¡€çš„ ROS 2 åŠŸèƒ½ã€åº“ä¸ä¾èµ–ã€‚
* **Overlay**ï¼šä½ è‡ªå·±åˆ›å»ºçš„å·¥ä½œåŒºï¼ˆæ¯”å¦‚ `~/ros2_ws`ï¼‰ï¼Œç”¨äºæ”¾ç½®ä½ å¼€å‘æˆ–ä¿®æ”¹çš„åŒ…ã€‚
> ğŸ’¡ æ¯”å–»ï¼š
> * Underlay = â€œç³»ç»Ÿçº§ ROS å®‰è£…â€
> * Overlay = â€œä½ è‡ªå·±çš„ ROS å¼€å‘å±‚â€
>
> ä½ è¦åœ¨ overlay é‡Œåšçš„æ‰€æœ‰ç¼–è¯‘å’Œè¿è¡Œï¼Œéƒ½å¿…é¡»åŸºäº underlay ç¯å¢ƒã€‚

å› æ­¤åœ¨æ„å»ºè‡ªå·±çš„å·¥ä½œåŒºå‰ï¼Œå¿…é¡»å…ˆï¼š

```bash
source /opt/ros/galactic/setup.bash
```

---

ğŸ—ï¸ äºŒã€æ„å»ºå·¥ä½œåŒº
åœ¨å·¥ä½œåŒºæ ¹ç›®å½•æ‰§è¡Œï¼š
```bash
colcon build --symlink-install
```
* `--symlink-install` è®©ç”Ÿæˆçš„æ–‡ä»¶ä½¿ç”¨ç¬¦å·é“¾æ¥ï¼ˆsymlinkï¼‰ï¼Œ
  è¿™æ ·ä½ ä¿®æ”¹æºç ï¼ˆå°¤å…¶æ˜¯ Python èŠ‚ç‚¹ï¼‰æ—¶ï¼Œä¸ç”¨é‡æ–°ç¼–è¯‘å°±èƒ½ç”Ÿæ•ˆã€‚
---

ğŸ§ª ä¸‰ã€è¿è¡Œæµ‹è¯•
```bash
colcon test
```
è¿™ä¼šè¿è¡Œæ¯ä¸ªåŒ…é‡Œçš„æµ‹è¯•ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚

---

ğŸ§± å››ã€åˆ›å»ºè‡ªå·±çš„ Package

åˆ›å»ºå‘½ä»¤ï¼š

```bash
ros2 pkg create my_pkg --build-type ament_cmake --dependencies rclcpp std_msgs
```

è¿™ç›¸å½“äº ROS 1 çš„ï¼š

```bash
catkin_create_package
```

æ„å»ºæ–¹å¼æœ‰ä¸‰ç§ï¼š

* `ament_cmake`ï¼ˆC++ æ¨èï¼‰
* `ament_python`ï¼ˆPython æ¨èï¼‰
* `pure cmake`ï¼ˆçº¯ CMake é¡¹ç›®ï¼‰

---

ğŸ’¨ äº”ã€colcon_cd å¿«æ·å‘½ä»¤

è®©ä½ èƒ½å¿«é€Ÿåˆ‡åˆ°åŒ…ç›®å½•ï¼Œä¾‹å¦‚ï¼š

```bash
colcon_cd my_pkg
```
ç­‰åŒäºï¼š
```bash
cd ~/ros2_ws/src/my_pkg
```
è¦å¯ç”¨ï¼š
```bash
echo "source /usr/share/colcon_cd/function/colcon_cd.sh" >> ~/.bashrc
echo "export _colcon_cd_root=/opt/ros/galactic/" >> ~/.bashrc
```

---

âŒ¨ï¸ å…­ã€colcon Tab è¡¥å…¨

å¦‚æœä½ æƒ³åœ¨è¾“å…¥ `colcon` å‘½ä»¤æ—¶æŒ‰ <kbd>Tab</kbd> è‡ªåŠ¨è¡¥å…¨ï¼Œéœ€è¦å®‰è£…ï¼š
```bash
sudo apt install python3-colcon-argcomplete
```
ç„¶ååœ¨ `.bashrc` ä¸­å¯ç”¨ï¼š
```bash
eval "$(register-python-argcomplete colcon)"
```

---

ğŸ’¡ ä¸ƒã€å®ç”¨ Tips

* å¿½ç•¥æŸä¸ªåŒ…ï¼š
  ```bash
  touch your_pkg/COLCON_IGNORE
  ```
* ç¦æ­¢ç¼–è¯‘æµ‹è¯•ï¼ˆèŠ‚çœæ—¶é—´ï¼‰ï¼š
  ```bash
  colcon build --cmake-args -DBUILD_TESTING=0
  ```
* åªè¿è¡ŒæŸä¸ªåŒ…çš„æµ‹è¯•ï¼š
  ```bash
  colcon test --packages-select my_pkg --ctest-args -R some_test
  ```
---

âœ… **æ€»ç»“ä¸€å¥è¯**ï¼š

> ROS 2 çš„æ„å»ºé€»è¾‘æ˜¯ï¼š
>
> **å…ˆ source underlay â†’ æ„å»º overlay â†’ source overlay â†’ è¿è¡ŒåŒ…**

ä½ è¦å§‹ç»ˆè®°ä½ä¸¤ä¸ª â€œsourceâ€ æ­¥éª¤ï¼š

```bash
source /opt/ros/galactic/setup.bash   # åŠ è½½ç³»ç»ŸROSç¯å¢ƒ
source install/setup.bash             # åŠ è½½ä½ è‡ªå·±ç¼–è¯‘çš„åŒ…
```

## 2 creating a workspace
> æ³¨æ„overlayå’Œunderlayçš„å…³ç³»
>
> å¤ªå¥½äº† ğŸ‘ ä½ ç°åœ¨åœ¨çœ‹çš„æ˜¯ **ROS 2 å®˜æ–¹æ•™ç¨‹ä¸­æœ€æ ¸å¿ƒçš„æ¦‚å¿µä¹‹ä¸€** â€”â€”
ğŸ‘‰ â€œ**å·¥ä½œç©ºé—´ï¼ˆworkspaceï¼‰**ã€**underlay** å’Œ **overlay**â€ çš„å…³ç³»ã€‚

ä¸‹é¢æˆ‘å¸®ä½ å®Œæ•´ã€åˆ†å±‚åœ°è§£è¯»è¿™ä¸€ç« çš„å†…å®¹ï¼Œè®©ä½ ä»æ¦‚å¿µåˆ°å®é™…å‘½ä»¤éƒ½ææ‡‚ã€‚

---

# ğŸš€ ä¸€ã€æ ¸å¿ƒæ¦‚å¿µæ€»è§ˆ

| æ¦‚å¿µ                  | ä¸­æ–‡ç†è§£                                    | ä¸¾ä¾‹                                      |
| ------------------- | --------------------------------------- | --------------------------------------- |
| **Workspaceï¼ˆå·¥ä½œç©ºé—´ï¼‰** | æ”¾ ROS 2 åŒ…çš„ä¸€ä¸ªç›®å½•                          | `~/ros2_ws`                             |
| **Underlayï¼ˆåº•å±‚ç¯å¢ƒï¼‰**  | å·²å®‰è£…çš„ ROS 2 ç¯å¢ƒï¼ˆæä¾›åŸºç¡€ä¾èµ–ï¼‰                   | `/opt/ros/galactic` æˆ– `/opt/ros/humble` |
| **Overlayï¼ˆå åŠ å±‚ï¼‰**    | ä½ è‡ªå·±ç¼–è¯‘çš„æ–°åŒ…æ‰€åœ¨çš„ workspaceï¼Œä¼šè¦†ç›– underlay ä¸­åŒååŒ… | `~/ros2_ws/install`                     |
| **Sourceï¼ˆåŠ è½½ç¯å¢ƒï¼‰**    | æŠŠ ROS ç¯å¢ƒå˜é‡åŠ è½½è¿›å½“å‰ç»ˆç«¯                       | `source install/setup.bash`             |

---

ğŸ§© äºŒã€ä¸ºä»€ä¹ˆéœ€è¦ underlay / overlayï¼Ÿ

åœ¨ ROS 2 é‡Œï¼Œä½ å¾€å¾€æœ‰ä¸¤ä¸ªå±‚æ¬¡çš„ä»£ç ï¼š

1. **ç³»ç»Ÿå®‰è£…å¥½çš„ï¼ˆç¨³å®šçš„ï¼‰ROS 2 æ ¸å¿ƒåŒ…** â€” ä¸å¸¸æ”¹ã€‚
2. **ä½ è‡ªå·±å¼€å‘æˆ–ä¿®æ”¹çš„åŒ…** â€” éœ€è¦é¢‘ç¹ç¼–è¯‘æµ‹è¯•ã€‚

ä½ å¯ä»¥ï¼š

* æŠŠç³»ç»Ÿå®‰è£…çš„ ROS 2 å½“æˆ **underlay**ï¼ˆåº•å±‚ä¾èµ–ï¼‰ï¼›
* æŠŠä½ è‡ªå·±çš„åŒ…æ”¾åœ¨æ–°çš„ **workspace** ä¸­ï¼ˆç§°ä¸º overlayï¼‰ã€‚

è¿™æ ·ï¼š

* ä½ çš„åŒ…ä¼šè¦†ç›–åŒåç³»ç»ŸåŒ…ï¼›
* ä¸éœ€è¦æ¯æ¬¡éƒ½é‡ç¼–æ•´ä¸ª ROSï¼›
* å¯ä»¥è‡ªç”±ä¿®æ”¹ã€å®éªŒã€æµ‹è¯•ã€‚

---

ğŸ§  ä¸‰ã€æ•´ä¸ªæ•™ç¨‹é€æ­¥è®²äº†ä»€ä¹ˆï¼Ÿ

**1ï¸âƒ£ Source ROS 2 environmentï¼ˆåŠ è½½ underlayï¼‰**

è®©ç³»ç»ŸçŸ¥é“ ROS çš„å‘½ä»¤åœ¨å“ªã€‚
æ¯”å¦‚ï¼š

```bash
source /opt/ros/rolling/setup.bash
```

è¿™ä¸€æ­¥æ˜¯å‘Šè¯‰ shellï¼š
â€œæˆ‘ç°åœ¨æƒ³åœ¨ ROS ç¯å¢ƒé‡Œå·¥ä½œã€‚â€

---

**2ï¸âƒ£ Create a workspace**

åˆ›å»ºä½ è‡ªå·±çš„å¼€å‘å·¥ä½œåŒºï¼š

```bash
mkdir -p ~/ros2_ws/src
cd ~/ros2_ws/src
```

è¿™å°±ç›¸å½“äºï¼š

```
ros2_ws/
â”œâ”€â”€ src/      # æ”¾æºä»£ç çš„åœ°æ–¹
```

---

**3ï¸âƒ£ Clone a sample repo**

ä¸‹è½½ä¸€ä¸ªä¾‹å­åŒ…ï¼Œæ¯”å¦‚ turtlesimï¼š

```bash
git clone https://github.com/ros/ros_tutorials.git -b rolling
```

ç°åœ¨ï¼š

```
ros2_ws/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ ros_tutorials/
â”‚       â””â”€â”€ turtlesim/
```

---

 **4ï¸âƒ£ Resolve dependenciesï¼ˆè§£å†³ä¾èµ–ï¼‰**

è‡ªåŠ¨å®‰è£… turtlesim éœ€è¦çš„ä¾èµ–åŒ…ï¼š

```bash
cd ~/ros2_ws
rosdep install -i --from-path src --rosdistro rolling -y
```

ğŸ“˜ `rosdep` ä¼šæŸ¥çœ‹æ¯ä¸ªåŒ…çš„ `package.xml`ï¼Œå®‰è£…ç¼ºå°‘çš„ä¾èµ–ã€‚

---

**5ï¸âƒ£ Build the workspace with colcon**

ç¼–è¯‘æ•´ä¸ª workspaceï¼š

```bash
colcon build --symlink-install
```

ç¼–è¯‘åä¼šç”Ÿæˆï¼š

```
ros2_ws/
â”œâ”€â”€ build/
â”œâ”€â”€ install/
â”œâ”€â”€ log/
â””â”€â”€ src/
```

å…¶ä¸­ï¼š

* `build/`ï¼šä¸­é—´ç¼–è¯‘æ–‡ä»¶
* `install/`ï¼šæœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶ã€ç¯å¢ƒè„šæœ¬
* `log/`ï¼šæ„å»ºæ—¥å¿—

---

**6ï¸âƒ£ Source the overlay**

ç¼–è¯‘å®Œä¹‹åè¦â€œæ¿€æ´»â€è¿™ä¸ª workspaceï¼š

âš ï¸ ä¸€å®šè¦åœ¨ä¸€ä¸ª**æ–°ç»ˆç«¯**æ‰§è¡Œï¼ˆé¿å…æ±¡æŸ“ä¹‹å‰çš„ç¯å¢ƒï¼‰ï¼š

```bash
source /opt/ros/rolling/setup.bash    # åŠ è½½ underlay
cd ~/ros2_ws
source install/local_setup.bash       # åŠ è½½ overlay
```

ç°åœ¨ï¼š

* ä½ èƒ½ç”¨ `/opt/ros/rolling` é‡Œçš„åŒ…ï¼›
* ä¹Ÿèƒ½ç”¨ `~/ros2_ws/install` é‡Œçš„åŒ…ï¼›
* å¦‚æœä¸¤è€…é‡åï¼Œ**overlay ä¼˜å…ˆ**ã€‚

---

**7ï¸âƒ£ Modify the overlay**

ä¿®æ”¹ overlay ä¸­çš„åŒ…ï¼Œç„¶åé‡æ–°ç¼–è¯‘ï¼š

```bash
# ä¿®æ”¹ ~/ros2_ws/src/ros_tutorials/turtlesim/src/turtle_frame.cpp
setWindowTitle("MyTurtleSim");

colcon build
```

é‡æ–°è¿è¡Œï¼š

```bash
ros2 run turtlesim turtlesim_node
```

çª—å£æ ‡é¢˜å˜æˆäº† `MyTurtleSim`ã€‚
è¿™è¯´æ˜ä½ è¿è¡Œçš„æ˜¯ overlay çš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿè‡ªå¸¦çš„ã€‚

---

ğŸ§© å››ã€æ€»ç»“å¯¹æ¯”

| æ¦‚å¿µ                          | ä½ç½®                            | ä½œç”¨             |
| --------------------------- | ----------------------------- | -------------- |
| **Underlay**                | `/opt/ros/<distro>/`          | å®˜æ–¹å®‰è£…çš„ ROS 2 ç¯å¢ƒ |
| **Overlay**                 | `~/ros2_ws/`                  | ä½ è‡ªå·±ç¼–è¯‘çš„åŒ…        |
| **source setup.bash**       | æ¿€æ´»æ•´ä¸ªç¯å¢ƒï¼ˆåŒ…æ‹¬ underlayï¼‰           |                |
| **source local_setup.bash** | ä»…æ¿€æ´» overlayï¼ˆåœ¨å·²æœ‰ underlay åŸºç¡€ä¸Šï¼‰ |                |

---

âš™ï¸ äº”ã€å¸¸è§å‘½ä»¤é€ŸæŸ¥

| æ“ä½œ           | å‘½ä»¤                                                          |
| ------------ | ----------------------------------------------------------- |
| åˆ›å»º workspace | `mkdir -p ~/ros2_ws/src`                                    |
| å…‹éš†åŒ…          | `git clone <repo>`                                          |
| å®‰è£…ä¾èµ–         | `rosdep install -i --from-path src --rosdistro <distro> -y` |
| ç¼–è¯‘           | `colcon build --symlink-install`                            |
| è¿è¡Œ           | `ros2 run <package> <node>`                                 |
| æ¿€æ´»ç¯å¢ƒ         | `source install/setup.bash`                                 |

---

ğŸ’¬ å…­ã€ä¸€å¥è¯è®°ä½

> ROS 2 workspace = ä¸€ä¸ªå¯ä»¥â€œå åŠ â€åˆ°ç³»ç»Ÿ ROS çš„å¼€å‘ç¯å¢ƒã€‚
> Underlay æ˜¯åŸºç¡€ï¼›Overlay æ˜¯ä½ æ”¹çš„ã€‚
> `source setup.bash` å°±æ˜¯å‘Šè¯‰ç³»ç»Ÿï¼šâ€œç”¨æˆ‘è¿™ä¸ªç‰ˆæœ¬ï¼â€

---

æ˜¯å¦è¦æˆ‘å¸®ä½ ç”»ä¸€å¼ â€œunderlay / overlayâ€ å åŠ å…³ç³»çš„å›¾ï¼Ÿ
å›¾å½¢åŒ–çœ‹ä¸€éï¼Œä½ ä¼šå½»åº•ææ‡‚å®ƒçš„ä¼˜å…ˆçº§åŸç†ã€‚
