## 1 using colcon to build packages

🧩 一、Underlay 与 Overlay 概念
* **Underlay**：你已经安装好的 ROS 2 环境（比如 `/opt/ros/galactic`）。
  它提供基础的 ROS 2 功能、库与依赖。
* **Overlay**：你自己创建的工作区（比如 `~/ros2_ws`），用于放置你开发或修改的包。
> 💡 比喻：
> * Underlay = “系统级 ROS 安装”
> * Overlay = “你自己的 ROS 开发层”
>
> 你要在 overlay 里做的所有编译和运行，都必须基于 underlay 环境。

因此在构建自己的工作区前，必须先：

```bash
source /opt/ros/galactic/setup.bash
```

---

🏗️ 二、构建工作区
在工作区根目录执行：
```bash
colcon build --symlink-install
```
* `--symlink-install` 让生成的文件使用符号链接（symlink），
  这样你修改源码（尤其是 Python 节点）时，不用重新编译就能生效。
---

🧪 三、运行测试
```bash
colcon test
```
这会运行每个包里的测试（如果有）。

---

🧱 四、创建自己的 Package

创建命令：

```bash
ros2 pkg create my_pkg --build-type ament_cmake --dependencies rclcpp std_msgs
```

这相当于 ROS 1 的：

```bash
catkin_create_package
```

构建方式有三种：

* `ament_cmake`（C++ 推荐）
* `ament_python`（Python 推荐）
* `pure cmake`（纯 CMake 项目）

---

💨 五、colcon_cd 快捷命令

让你能快速切到包目录，例如：

```bash
colcon_cd my_pkg
```
等同于：
```bash
cd ~/ros2_ws/src/my_pkg
```
要启用：
```bash
echo "source /usr/share/colcon_cd/function/colcon_cd.sh" >> ~/.bashrc
echo "export _colcon_cd_root=/opt/ros/galactic/" >> ~/.bashrc
```

---

⌨️ 六、colcon Tab 补全

如果你想在输入 `colcon` 命令时按 <kbd>Tab</kbd> 自动补全，需要安装：
```bash
sudo apt install python3-colcon-argcomplete
```
然后在 `.bashrc` 中启用：
```bash
eval "$(register-python-argcomplete colcon)"
```

---

💡 七、实用 Tips

* 忽略某个包：
  ```bash
  touch your_pkg/COLCON_IGNORE
  ```
* 禁止编译测试（节省时间）：
  ```bash
  colcon build --cmake-args -DBUILD_TESTING=0
  ```
* 只运行某个包的测试：
  ```bash
  colcon test --packages-select my_pkg --ctest-args -R some_test
  ```
---

✅ **总结一句话**：

> ROS 2 的构建逻辑是：
>
> **先 source underlay → 构建 overlay → source overlay → 运行包**

你要始终记住两个 “source” 步骤：

```bash
source /opt/ros/galactic/setup.bash   # 加载系统ROS环境
source install/setup.bash             # 加载你自己编译的包
```

## 2 creating a workspace
> 注意overlay和underlay的关系
>
> 太好了 👍 你现在在看的是 **ROS 2 官方教程中最核心的概念之一** ——
👉 “**工作空间（workspace）**、**underlay** 和 **overlay**” 的关系。

下面我帮你完整、分层地解读这一章的内容，让你从概念到实际命令都搞懂。

---

# 🚀 一、核心概念总览

| 概念                  | 中文理解                                    | 举例                                      |
| ------------------- | --------------------------------------- | --------------------------------------- |
| **Workspace（工作空间）** | 放 ROS 2 包的一个目录                          | `~/ros2_ws`                             |
| **Underlay（底层环境）**  | 已安装的 ROS 2 环境（提供基础依赖）                   | `/opt/ros/galactic` 或 `/opt/ros/humble` |
| **Overlay（叠加层）**    | 你自己编译的新包所在的 workspace，会覆盖 underlay 中同名包 | `~/ros2_ws/install`                     |
| **Source（加载环境）**    | 把 ROS 环境变量加载进当前终端                       | `source install/setup.bash`             |

---

🧩 二、为什么需要 underlay / overlay？

在 ROS 2 里，你往往有两个层次的代码：

1. **系统安装好的（稳定的）ROS 2 核心包** — 不常改。
2. **你自己开发或修改的包** — 需要频繁编译测试。

你可以：

* 把系统安装的 ROS 2 当成 **underlay**（底层依赖）；
* 把你自己的包放在新的 **workspace** 中（称为 overlay）。

这样：

* 你的包会覆盖同名系统包；
* 不需要每次都重编整个 ROS；
* 可以自由修改、实验、测试。

---

🧠 三、整个教程逐步讲了什么？

**1️⃣ Source ROS 2 environment（加载 underlay）**

让系统知道 ROS 的命令在哪。
比如：

```bash
source /opt/ros/rolling/setup.bash
```

这一步是告诉 shell：
“我现在想在 ROS 环境里工作。”

---

**2️⃣ Create a workspace**

创建你自己的开发工作区：

```bash
mkdir -p ~/ros2_ws/src
cd ~/ros2_ws/src
```

这就相当于：

```
ros2_ws/
├── src/      # 放源代码的地方
```

---

**3️⃣ Clone a sample repo**

下载一个例子包，比如 turtlesim：

```bash
git clone https://github.com/ros/ros_tutorials.git -b rolling
```

现在：

```
ros2_ws/
├── src/
│   └── ros_tutorials/
│       └── turtlesim/
```

---

 **4️⃣ Resolve dependencies（解决依赖）**

自动安装 turtlesim 需要的依赖包：

```bash
cd ~/ros2_ws
rosdep install -i --from-path src --rosdistro rolling -y
```

📘 `rosdep` 会查看每个包的 `package.xml`，安装缺少的依赖。

---

**5️⃣ Build the workspace with colcon**

编译整个 workspace：

```bash
colcon build --symlink-install
```

编译后会生成：

```
ros2_ws/
├── build/
├── install/
├── log/
└── src/
```

其中：

* `build/`：中间编译文件
* `install/`：最终可执行文件、环境脚本
* `log/`：构建日志

---

**6️⃣ Source the overlay**

编译完之后要“激活”这个 workspace：

⚠️ 一定要在一个**新终端**执行（避免污染之前的环境）：

```bash
source /opt/ros/rolling/setup.bash    # 加载 underlay
cd ~/ros2_ws
source install/local_setup.bash       # 加载 overlay
```

现在：

* 你能用 `/opt/ros/rolling` 里的包；
* 也能用 `~/ros2_ws/install` 里的包；
* 如果两者重名，**overlay 优先**。

---

**7️⃣ Modify the overlay**

修改 overlay 中的包，然后重新编译：

```bash
# 修改 ~/ros2_ws/src/ros_tutorials/turtlesim/src/turtle_frame.cpp
setWindowTitle("MyTurtleSim");

colcon build
```

重新运行：

```bash
ros2 run turtlesim turtlesim_node
```

窗口标题变成了 `MyTurtleSim`。
这说明你运行的是 overlay 的版本，而不是系统自带的。

---

🧩 四、总结对比

| 概念                          | 位置                            | 作用             |
| --------------------------- | ----------------------------- | -------------- |
| **Underlay**                | `/opt/ros/<distro>/`          | 官方安装的 ROS 2 环境 |
| **Overlay**                 | `~/ros2_ws/`                  | 你自己编译的包        |
| **source setup.bash**       | 激活整个环境（包括 underlay）           |                |
| **source local_setup.bash** | 仅激活 overlay（在已有 underlay 基础上） |                |

---

⚙️ 五、常见命令速查

| 操作           | 命令                                                          |
| ------------ | ----------------------------------------------------------- |
| 创建 workspace | `mkdir -p ~/ros2_ws/src`                                    |
| 克隆包          | `git clone <repo>`                                          |
| 安装依赖         | `rosdep install -i --from-path src --rosdistro <distro> -y` |
| 编译           | `colcon build --symlink-install`                            |
| 运行           | `ros2 run <package> <node>`                                 |
| 激活环境         | `source install/setup.bash`                                 |

---

💬 六、一句话记住

> ROS 2 workspace = 一个可以“叠加”到系统 ROS 的开发环境。
> Underlay 是基础；Overlay 是你改的。
> `source setup.bash` 就是告诉系统：“用我这个版本！”

---

## 3 creating a package
非常好 👍
你贴的这段是 **ROS 2 官方教程**中《Creating a package》的详细说明，
我来帮你完整地用中文把这一段总结、讲解一下，让你彻底明白这部分内容的**核心逻辑和操作流程**。

---



🧭 一、这章的目标

👉 让你从零开始学会：

1. 在 ROS 2 工作空间中 **创建一个包（package）**
2. **编译** 这个包
3. **运行节点**（node）
4. 理解 package 的组成结构（CMakeLists.txt、package.xml 等）

---

🧩 二、什么是 ROS 2 的 package？

在 ROS 2 中：

> **一个 package 就是你所有代码的最小组织单位。**

比如：

* 你要写一个 C++ 节点（publisher/subscriber）
* 你要定义一个新消息类型
* 你要写一个工具节点

都要放进一个 **package**。

💡 所以可以理解为：

> “Package” = 带有完整依赖说明、编译说明、源代码、安装规则的代码包。

---

 🏗️ 三、ROS 2 package 的组成结构

以 C++ 为例，一个最小的 ROS 2 包包含以下文件：

```
my_package/
├── CMakeLists.txt        # 编译逻辑（告诉CMake怎么编译）
├── package.xml           # 包信息与依赖（告诉ROS这个包是谁）
├── include/my_package/   # 头文件
└── src/                  # 源码，比如 .cpp 文件
```

如果你用 Python 写节点，会是：

```
my_package/
├── package.xml
├── setup.py
├── setup.cfg
├── resource/
└── my_package/  # Python源文件
```

---

🧱 四、Package 与 Workspace（工作空间）的关系

你所有的包都应该放在一个工作空间（workspace）下面，比如：

```
ros2_ws/
├── src/
│   ├── my_package/
│   ├── demo_nodes_cpp/
│   └── my_python_tool/
```

🧩 **规则**：

* 可以有多个包；
* 不允许嵌套包；
* 可以混合 Python / CMake 包；
* 推荐所有包都放在 `src/` 下。

---

⚙️ 五、创建包的命令

假设你已经有工作空间：

```bash
mkdir -p ~/ros2_ws/src
cd ~/ros2_ws/src
```

创建一个新的 C++ 包：

```bash
ros2 pkg create --build-type ament_cmake --license Apache-2.0 --node-name my_node my_package
```

这条命令会自动生成：

```
my_package/
├── CMakeLists.txt
├── include/my_package/
├── package.xml
└── src/my_node.cpp
```

其中：

* `--build-type ament_cmake` → 使用 CMake 构建；
* `--node-name my_node` → 自动生成一个简单的 “hello world” 节点；
* `--license Apache-2.0` → 声明开源许可证。

---

🧩 六、编译 package

切回工作空间根目录：

```bash
cd ~/ros2_ws
colcon build
```

💡 如果你只想编译一个包（加快速度）：

```bash
colcon build --packages-select my_package
```

构建完成后会生成：

```
ros2_ws/
├── build/
├── install/
└── log/
```

---

🌱 七、使用前要 source 环境

每次编译完新包后，你要重新 **加载环境变量**：

```bash
source install/local_setup.bash
```

否则 ROS 不知道你新增的包。

---

🚀 八、运行节点

执行：

```bash
ros2 run my_package my_node
```

终端输出：

```
hello world my_package package
```

这说明你的 package 正常工作 ✅

---

🔍 九、修改 package.xml

自动生成的 `package.xml` 有几个 “TODO”：

```xml
<description>TODO: Package description</description>
<maintainer email="user@todo.todo">user</maintainer>
<license>TODO: License declaration</license>
```

请改成你自己的信息：

```xml
<description>Beginner client libraries tutorials practice package</description>
<maintainer email="you@example.com">Your Name</maintainer>
<license>Apache-2.0</license>
```

这些信息在你发布包到 GitHub / ROS index 时非常重要。

---

🧩 十、总结

| 步骤    | 命令                                                          | 说明         |
| ----- | ----------------------------------------------------------- | ---------- |
| 创建包   | `ros2 pkg create --build-type ament_cmake my_package`       | 自动生成模板     |
| 编译    | `colcon build`                                              | 编译所有包      |
| 选择性编译 | `colcon build --packages-select my_package`                 | 仅编译一个包     |
| 加载环境  | `source install/local_setup.bash`                           | 让ROS识别新包   |
| 运行节点  | `ros2 run my_package my_node`                               | 执行节点程序     |
| 安装依赖  | `rosdep install -i --from-path src --rosdistro <distro> -y` | 自动安装依赖     |
| 修改说明  | 编辑 `package.xml`                                            | 填写描述、作者、依赖 |

---

---

