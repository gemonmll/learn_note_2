éå¸¸å¥½ ğŸ‘ï¼Œä½ è´´çš„æ˜¯ä¸€ä¸ª **ROS 2 â€œæœ€å°å‘å¸ƒè€…â€ (Minimal Publisher)** çš„ç¤ºä¾‹ã€‚
è¿™æ˜¯ç†è§£ ROS 2 **Publisher** æ¦‚å¿µçš„ç»å…¸ä¾‹å­ã€‚ä¸‹é¢æˆ‘å¸®ä½ ä¸€æ­¥æ­¥è®²æ¸…æ¥šè¿™æ®µä»£ç åšäº†ä»€ä¹ˆã€‚

---

## ğŸ§© ä¸€ã€ç¨‹åºåŠŸèƒ½æ¦‚è¿°

ğŸ‘‰ è¿™æ˜¯ä¸€ä¸ª ROS 2 èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹åä¸º **`minimal_publisher`**ã€‚
å®ƒæ¯éš” **0.5 ç§’ï¼ˆ500msï¼‰** å‘å¸ƒä¸€æ¡æ¶ˆæ¯åˆ°è¯é¢˜ `/topic`ã€‚
æ¶ˆæ¯å†…å®¹æ˜¯ `"Hello, world! N"`ï¼ˆN æ˜¯é€’å¢çš„æ•°å­—ï¼‰ã€‚

---

## ğŸ” äºŒã€ç»“æ„åˆ†è§£è®²è§£

### 1ï¸âƒ£ å¤´æ–‡ä»¶å¯¼å…¥

```cpp
#include <chrono>
#include <memory>
#include <string>

#include "rclcpp/rclcpp.hpp"
#include "std_msgs/msg/string.hpp"
```

* `<chrono>`ï¼šç”¨äºæ—¶é—´æ“ä½œï¼ˆè¿™é‡Œæ˜¯å®šæ—¶å™¨çš„æ—¶é—´é—´éš”ï¼‰
* `<memory>`ï¼šç”¨äº `std::shared_ptr`
* `<string>`ï¼šå­—ç¬¦ä¸²æ“ä½œ
* `rclcpp.hpp`ï¼šROS 2 C++ å®¢æˆ·ç«¯åº“çš„ä¸»è¦å¤´æ–‡ä»¶
* `std_msgs/msg/string.hpp`ï¼šROS 2 æ ‡å‡†å­—ç¬¦ä¸²æ¶ˆæ¯ç±»å‹

---

### 2ï¸âƒ£ èŠ‚ç‚¹ç±»å®šä¹‰

```cpp
class MinimalPublisher : public rclcpp::Node
```

* ç»§æ‰¿è‡ª `rclcpp::Node`ï¼Œä»£è¡¨ä¸€ä¸ª ROS 2 èŠ‚ç‚¹ã€‚
* ROS 2 æ¨èä½¿ç”¨â€œé¢å‘å¯¹è±¡â€çš„å†™æ³•ï¼Œè€Œä¸æ˜¯è£¸å‡½æ•°ã€‚

---

### 3ï¸âƒ£ æ„é€ å‡½æ•°ï¼šåˆå§‹åŒ–å‘å¸ƒè€…å’Œå®šæ—¶å™¨

```cpp
MinimalPublisher()
: Node("minimal_publisher"), count_(0)
```

* `Node("minimal_publisher")` è®¾ç½®èŠ‚ç‚¹åç§°ï¼›
* `count_(0)` åˆå§‹åŒ–è®¡æ•°å™¨ã€‚

---

### 4ï¸âƒ£ åˆ›å»º Publisherï¼ˆå‘å¸ƒè€…ï¼‰

```cpp
publisher_ = this->create_publisher<std_msgs::msg::String>("topic", 10);
```

* æ¨¡æ¿å‚æ•° `<std_msgs::msg::String>` æŒ‡å®šæ¶ˆæ¯ç±»å‹ï¼›
* `"topic"` æ˜¯è¯é¢˜åç§°ï¼›
* `10` æ˜¯é˜Ÿåˆ—å¤§å°ï¼ˆç¼“å†² 10 æ¡æœªå‘é€çš„æ¶ˆæ¯ï¼‰ã€‚

ğŸ‘‰ ç›¸å½“äºå‘Šè¯‰ ROS 2ï¼š

> â€œæˆ‘æƒ³å‘å¸ƒ `std_msgs/msg/String` ç±»å‹çš„æ¶ˆæ¯åˆ° `/topic` è¯é¢˜ã€‚â€

---

### 5ï¸âƒ£ åˆ›å»ºå®šæ—¶å™¨ï¼ˆå‘¨æœŸæ€§å›è°ƒï¼‰

```cpp
auto timer_callback = [this]() -> void {
  auto message = std_msgs::msg::String();
  message.data = "Hello, world! " + std::to_string(this->count_++);
  RCLCPP_INFO(this->get_logger(), "Publishing: '%s'", message.data.c_str());
  this->publisher_->publish(message);
};
timer_ = this->create_wall_timer(500ms, timer_callback);
```

* è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ª **lambda å‡½æ•°** ä½œä¸ºå›è°ƒï¼›
* æ¯éš” `500ms` æ‰§è¡Œä¸€æ¬¡ï¼›
* æ¯æ¬¡ï¼š

  * åˆ›å»ºæ¶ˆæ¯ï¼›
  * å¡«å……å­—ç¬¦ä¸²å†…å®¹ï¼›
  * æ‰“å°æ—¥å¿—ï¼›
  * é€šè¿‡å‘å¸ƒè€…å‘å¸ƒå‡ºå»ã€‚

ğŸ§  è¿™é‡Œçš„ `[this]` æ˜¯æ•è·å½“å‰å¯¹è±¡æŒ‡é’ˆï¼Œè®© lambda èƒ½è®¿é—®ç±»æˆå‘˜ï¼ˆæ¯”å¦‚ `publisher_`ï¼‰ã€‚

---

### 6ï¸âƒ£ ä¸»å‡½æ•°

```cpp
int main(int argc, char * argv[])
{
  rclcpp::init(argc, argv);                          // åˆå§‹åŒ– ROS 2
  rclcpp::spin(std::make_shared<MinimalPublisher>()); // åˆ›å»ºå¹¶è¿è¡ŒèŠ‚ç‚¹
  rclcpp::shutdown();                                // é€€å‡ºæ¸…ç†
  return 0;
}
```

* `rclcpp::spin()` ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œè®©èŠ‚ç‚¹ä¸€ç›´è¿è¡Œï¼›
* å½“ä½ æŒ‰ä¸‹ `Ctrl+C` æ—¶ä¼šè§¦å‘ `rclcpp::shutdown()` é€€å‡ºã€‚

---

## âš™ï¸ ä¸‰ã€ç¼–è¯‘ä¸è¿è¡Œ

1ï¸âƒ£ **åœ¨ ROS 2 å·¥ä½œåŒºä¸­åˆ›å»ºåŒ…**

```bash
ros2 pkg create --build-type ament_cmake cpp_pubsub --dependencies rclcpp std_msgs
```

2ï¸âƒ£ **æŠŠä¸Šé¢çš„ä»£ç ä¿å­˜ä¸º**

```
cpp_pubsub/src/publisher_member_function.cpp
```

3ï¸âƒ£ **ç¼–è¯‘**

```bash
colcon build --packages-select cpp_pubsub
source install/setup.bash
```

4ï¸âƒ£ **è¿è¡Œ**

```bash
ros2 run cpp_pubsub publisher_member_function
```

5ï¸âƒ£ **æŸ¥çœ‹å‘å¸ƒæ¶ˆæ¯**

```bash
ros2 topic echo /topic
```

è¾“å‡ºç±»ä¼¼ï¼š

```
data: "Hello, world! 0"
data: "Hello, world! 1"
data: "Hello, world! 2"
...
```

---

## ğŸ§  å››ã€ç¨‹åºé€»è¾‘æ€»ç»“

| åŠŸèƒ½     | å®ç°æ–¹å¼                                                   |
| ------ | ------------------------------------------------------ |
| èŠ‚ç‚¹å‘½å   | `Node("minimal_publisher")`                            |
| å®šä¹‰å‘å¸ƒè€…  | `create_publisher<std_msgs::msg::String>("topic", 10)` |
| å‘å¸ƒå‘¨æœŸ   | 500ms                                                  |
| æ¶ˆæ¯ç±»å‹   | `std_msgs::msg::String`                                |
| æ—¥å¿—è¾“å‡º   | `RCLCPP_INFO()`                                        |
| èŠ‚ç‚¹è¿è¡Œå¾ªç¯ | `rclcpp::spin()`                                       |

---



```cpp
#include <chrono>
#include <memory>
#include <string>

#include "rclcpp/rclcpp.hpp"
#include "std_msgs/msg/string.hpp"

using namespace std::chrono_literals;

/* This example creates a subclass of Node and uses a fancy C++11 lambda
* function to shorten the callback syntax, at the expense of making the
* code somewhat more difficult to understand at first glance. */

class MinimalPublisher : public rclcpp::Node
{
public:
  MinimalPublisher()
  : Node("minimal_publisher"), count_(0)
  {
    publisher_ = this->create_publisher<std_msgs::msg::String>("topic", 10);
    auto timer_callback =
      [this]() -> void {
        auto message = std_msgs::msg::String();
        message.data = "Hello, world! " + std::to_string(this->count_++);
        RCLCPP_INFO(this->get_logger(), "Publishing: '%s'", message.data.c_str());
        this->publisher_->publish(message);
      };
    timer_ = this->create_wall_timer(500ms, timer_callback);
  }

private:
  rclcpp::TimerBase::SharedPtr timer_;
  rclcpp::Publisher<std_msgs::msg::String>::SharedPtr publisher_;
  size_t count_;
};

int main(int argc, char * argv[])
{
  rclcpp::init(argc, argv);
  rclcpp::spin(std::make_shared<MinimalPublisher>());
  rclcpp::shutdown();
  return 0;
}

```