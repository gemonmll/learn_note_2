è¿™æ˜¯ä¸€ä¸ª**å¾ˆå¸¸è§çš„ Linux + Node.js + sudo ç¯å¢ƒé—®é¢˜**ï¼Œæœ¬è´¨åŸå› æ˜¯ï¼š

> **æ™®é€šç”¨æˆ·å’Œ `sudo` ä½¿ç”¨çš„æ˜¯ä¸åŒçš„ Node.js è·¯å¾„ï¼ˆPATHï¼‰**

---

## ä¸€ã€é—®é¢˜åŸå› ï¼ˆä½ ç°åœ¨çš„çŠ¶æ€ï¼‰

```bash
node -v        # v16.16.0
sudo node -v   # v14.17.6
```

è¯´æ˜ï¼š

* **Node v16.16.0** æ˜¯è£…åœ¨ **ç”¨æˆ·ç¯å¢ƒ**é‡Œçš„
  ğŸ‘‰ å¸¸è§äº `nvm` / `fnm` / æ‰‹åŠ¨å®‰è£…åœ¨ `/usr/local`
* **sudo** ä¼šï¼š

  * å¿½ç•¥ä½ çš„ç”¨æˆ· PATH
  * ä½¿ç”¨ `/etc/sudoers` é‡Œçš„ `secure_path`
  * æ‰¾åˆ°çš„æ˜¯ **ç³»ç»Ÿè‡ªå¸¦çš„ Node v14**

å¯ä»¥éªŒè¯ï¼š

```bash
which node
sudo which node
```

ä½ ä¼šçœ‹åˆ°ä¸¤ä¸ªä¸åŒè·¯å¾„ã€‚

---

## äºŒã€æ¨èè§£å†³æ–¹æ¡ˆï¼ˆæŒ‰æ¨èç¨‹åº¦æ’åºï¼‰

### âœ… æ–¹æ¡ˆ 1ï¼šè®© sudo ç»§æ‰¿ä½ çš„ Node 16ï¼ˆ**æœ€æ¨è**ï¼‰

#### 1ï¸âƒ£ æ‰¾åˆ° Node 16 çš„çœŸå®è·¯å¾„

```bash
which node
```

ä¾‹å¦‚è¾“å‡ºï¼š

```text
/home/sensetime/.nvm/versions/node/v16.16.0/bin/node
```

#### 2ï¸âƒ£ ç”¨ `sudo` æ˜¾å¼æŒ‡å®š PATH

```bash
sudo env PATH=$PATH node -v
```

å¦‚æœè¾“å‡ºï¼š

```text
v16.16.0
```

è¯´æ˜å¯è¡Œã€‚

#### 3ï¸âƒ£ æ°¸ä¹…æ–¹æ¡ˆï¼ˆå†™ aliasï¼‰

åœ¨ `~/.bashrc` æˆ– `~/.zshrc` åŠ ï¼š

```bash
alias sudo='sudo env PATH=$PATH'
```

âš ï¸ **æ³¨æ„**ï¼š
è¿™æ˜¯å¼€å‘æœºæ¨èï¼Œç”Ÿäº§æœåŠ¡å™¨æ…ç”¨ï¼ˆä½†ä½ è¿™ä¸ªåœºæ™¯æ˜¯å¼€å‘ç¯å¢ƒï¼Œæ²¡é—®é¢˜ï¼‰ã€‚

---

### âœ… æ–¹æ¡ˆ 2ï¼šç›´æ¥ç”¨ Node 16 çš„å®Œæ•´è·¯å¾„ï¼ˆæœ€å®‰å…¨ï¼‰

```bash
sudo /home/sensetime/.nvm/versions/node/v16.16.0/bin/node -v
```

æˆ–è€…ä½ çš„è„šæœ¬é‡Œï¼š

```bash
#!/usr/bin/env node
```

âŒ ä½†å¦‚æœ `sudo`ï¼Œ`env` è¿˜æ˜¯ä¼šæ‰¾ç³»ç»Ÿ node
âœ… æ‰€ä»¥æ›´ç¨³çš„æ˜¯ï¼š

```bash
#!/home/sensetime/.nvm/versions/node/v16.16.0/bin/node
```

---

### âœ… æ–¹æ¡ˆ 3ï¼šä¿®æ”¹ sudo çš„ secure_pathï¼ˆç³»ç»Ÿçº§ï¼‰

âš ï¸ **éœ€è¦è°¨æ…ï¼Œé€‚åˆä½ æ˜ç¡®çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆ**

```bash
sudo visudo
```

æ‰¾åˆ°è¿™ä¸€è¡Œï¼š

```text
Defaults secure_path="..."
```

æ”¹æˆï¼ˆç¤ºä¾‹ï¼‰ï¼š

```text
Defaults secure_path="/home/sensetime/.nvm/versions/node/v16.16.0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
```

ä¿å­˜åï¼š

```bash
sudo node -v
# v16.16.0
```

---

### âŒ ä¸æ¨èæ–¹æ¡ˆï¼šåˆ ç³»ç»Ÿ Node 14

```bash
sudo apt remove nodejs
```

ğŸš« ä¸å»ºè®®
å› ä¸ºå¯èƒ½ä¼šå½±å“ç³»ç»Ÿå·¥å…·ï¼ˆå¦‚ `apt`, `pm2`, æ—§è„šæœ¬ï¼‰

---

## ä¸‰ã€æˆ‘å»ºè®®ä½ çš„æœ€ä½³å®è·µï¼ˆæ€»ç»“ï¼‰

**å¼€å‘ç¯å¢ƒæ¨èï¼š**

```bash
# ä¸€æ¬¡æ€§
sudo env PATH=$PATH node xxx.js

# æˆ–æ°¸ä¹…
alias sudo='sudo env PATH=$PATH'
```

**ç”Ÿäº§ / CI / è‡ªåŠ¨åŒ–ï¼š**

* ä¸ç”¨ sudo è·‘ node
* æˆ–å†™ç»å¯¹è·¯å¾„ node
* æˆ–ç”¨ docker

---

## å››ã€å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç»§ç»­å¸®ä½ ï¼š

* åˆ¤æ–­ä½ ç°åœ¨æ˜¯ä¸æ˜¯ **nvm / fnm / apt è£…çš„ node**
* ç»™ä½ ä¸€å¥— **SenseAuto é¡¹ç›®æ ‡å‡† Node ç¯å¢ƒæ–¹æ¡ˆ**
* å¸®ä½ æ”¹è„šæœ¬ï¼Œå½»åº•é¿å… sudo + node çš„å‘

ä½ å¯ä»¥ç›´æ¥æŠŠï¼š

```bash
which node
ls -l $(which node)
```

è´´å‡ºæ¥ ğŸ‘
