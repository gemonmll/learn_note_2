下面按你这个场景来：**我在 `main` 分支上，想把 `feature` 分支的代码合进来**。我分别给你：

1. 命令行的标准做法（最常用、最稳）
2. 如果有冲突怎么处理/怎么撤销合并
3. 你用 **GitLens** 在 VS Code 里怎么“看差异、审改动、再合并”

---

## 1) 命令行：在 main 上合并 feature（推荐流程）

假设分支叫 `feature/login`（你换成自己的）。

### 步骤 0：确保 main 工作区干净

```bash
git status
```

如果不是干净的（有改动），先提交/暂存/丢弃，不然 merge 容易乱。

### 步骤 1：切到 main 并更新到最新

```bash
git checkout main
git pull origin main
```

### 步骤 2：合并 feature 到 main

```bash
git merge feature/login
```

### 步骤 3：推到远程（完成合并后的“备份”）

```bash
git push origin main
```

---

## 2) 合并时常见选择：普通 merge / 保留合并节点 / squash

### A. 普通 merge（默认）

```bash
git merge feature/login
```

* 如果 main 没动过，会“快进”（fast-forward），历史更线性
* 如果 main 也有新提交，会产生一次 merge commit 或需要冲突处理

### B. 强制生成一个合并提交（更清晰地表示“这是一次分支合并”）

```bash
git merge --no-ff feature/login
```

团队协作里挺常用，回头看历史一眼就知道这段来自哪个 feature。

### C. 把 feature 上的多个提交“压成一个提交”再合并（适合 AI/试错提交很多）

```bash
git merge --squash feature/login
git commit -m "feat: merge feature/login"
git push origin main
```

结果是 main 上只有一个干净提交，但 feature 分支的提交历史不会原样带过来。

---

## 3) 合并冲突怎么处理（以及怎么撤销合并）

### 3.1 出现冲突时

当你 `git merge feature/login` 后提示冲突：

1. 看哪些文件冲突：

```bash
git status
```

2. 打开冲突文件，选择保留哪部分（VS Code 会有按钮）
3. 解决后标记已解决：

```bash
git add <冲突文件>
```

4. 完成合并提交：

```bash
git commit
```

5. 推送：

```bash
git push origin main
```

### 3.2 我不想合了，想撤销这次 merge

在“合并过程中”（还没 commit）：

```bash
git merge --abort
```

如果你已经合并并 commit 了，但还没 push，可以回退到合并前（谨慎）：

```bash
git reset --hard HEAD~1
```

如果已经 push 了，推荐用 revert 去撤销（安全、不改历史）：

```bash
git revert -m 1 <merge_commit_hash>
git push
```

> `-m 1` 的意思是：以 main 那边作为主线来反做这次 merge。

---

## 4) VS Code + GitLens：怎么“审查 feature 改了啥”再合并

GitLens 的强项是 **看差异/看历史/定位是谁改的**。合并动作本身可以用内置 Git 或命令行完成，但 GitLens 能把“合并前的审查”做得非常顺。

### 4.1 在合并前，用 GitLens 对比 `main` vs `feature`

方法一（最常用）：Command Palette

* `Ctrl/Cmd + Shift + P`
* 搜索：**GitLens: Compare References**
* 选择 `main`
* 再选择 `feature/login`

你会得到一个对比视图，能看到：

* 哪些文件变了
* 每个文件的 diff
* 甚至按提交/作者等维度看变化

方法二：在 GitLens 的侧边栏（如果你开了）

* GitLens 面板里找到 **Branches**
* 右键 `feature/login` → 选择 **Compare with Current Branch**（当前在 main 时）

### 4.2 用 GitLens 快速审 AI/feature 改动质量

* **File History（文件历史）**：打开某文件 → 右上角/右键 → GitLens → File History
  看这个文件最近一系列提交是怎么演进的
* **Line Blame（行责）**：你光标停在一行上，会显示是谁、什么时候改的；点进去还能看提交详情
* **Commit Details（提交详情）**：在 GitLens 的提交列表里点某个 commit，可以看它改了哪些文件/具体 diff

> 实战建议：合并前先 `Compare main vs feature`，快速扫一遍“改动面”，再决定用普通 merge 还是 squash。

### 4.3 在 VS Code 里完成合并（不敲命令也行）

（这是 VS Code 内置 Source Control 的能力，GitLens 负责增强显示）

1. 左下角点分支名 → 切到 `main`
2. Source Control 里点 `...`（更多操作）
3. 选择 **Branch > Merge Branch...**
4. 选 `feature/login`
5. 如有冲突，VS Code 会提示，点开冲突文件解决
6. 提交 merge commit（或 squash 的 commit），然后 push

> 如果你选择 squash：VS Code UI 不一定直接给“merge --squash”的按钮，最稳还是用命令行那两句。

---

## 5) 给你一个“合并 feature 到 main”的最稳模板（照抄）

**普通 merge：**

```bash
git checkout main
git pull origin main
git merge feature/login
git push origin main
```

**改动很杂想压成一个提交：**

```bash
git checkout main
git pull origin main
git merge --squash feature/login
git commit -m "feat: merge feature/login"
git push origin main
```

---

如果你告诉我你现在的分支状态（比如 `git branch --show-current`、以及 feature 是否已经 push 到远程），我可以直接按你实际情况给你一条最合适的命令序列（是否需要 `--no-ff`/`--squash`、是否可能冲突、怎么最省事）。
