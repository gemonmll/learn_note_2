下面用一个完整例子带你把 **提交 PR → 代码评审 → 解决冲突 → merge 回 main** 走一遍（含命令行 + GitHub 网页 + VS Code 操作）。

我用例子：在仓库里新增一个接口 `GET /health`，分支名叫 `feature/health-endpoint`。

---

## 0) 前提：你得有远程仓库（GitHub/GitLab 都行）

* 你的本地项目已经 `git init` 并且有 `origin` 远程
* `main` 是主分支
* 你对仓库有 push 权限（或 fork 权限）

检查一下：

```bash
git remote -v
git branch
```

---

## 1) 从 main 开一个 feature 分支开发

### 1.1 切到 main 并更新

```bash
git checkout main
git pull origin main
```

### 1.2 新建并切到 feature 分支

```bash
git checkout -b feature/health-endpoint
```

### 1.3 写代码 + 提交

你改完文件后：

```bash
git status
git diff
git add -p       # 推荐：分块暂存，尤其 AI 改动很多时
git commit -m "feat: add /health endpoint"
```

---

## 2) 把 feature 分支推到远程（PR 的前置条件）

```bash
git push -u origin feature/health-endpoint
```

`-u` 会把上游分支绑定好，之后你在这个分支上只要 `git push` 就行。

---

## 3) 在 GitHub 上创建 PR（Pull Request）

### 3.1 网页操作（最常见）

1. 打开 GitHub 仓库页面
2. 通常会提示你 “Compare & pull request”，点它
   或者进 **Pull requests** → **New pull request**
3. 选择：

   * **base**: `main`
   * **compare**: `feature/health-endpoint`
4. 填 PR 标题与描述（建议写清楚：做了什么、怎么测、风险点）
5. 点 **Create pull request**

### 3.2 PR 描述怎么写（示例）

* Title: `feat: add health endpoint`
* Body:

  * What: 新增 `/health` 接口用于健康检查
  * Test: 本地 `curl http://localhost:3000/health` 返回 `200 OK`
  * Notes: 无破坏性变更

---

## 4) PR 里常见流程：检查 & 评审 & 修复

### 4.1 自动检查（CI）

PR 上一般会跑：

* 单测
* lint
* build

如果失败，你需要在本地修复后再次 commit + push：

```bash
# 修复...
git add .
git commit -m "fix: CI failing lint"
git push
```

PR 会自动更新（不用新建 PR）。

### 4.2 人工 Review

别人可能会留言 “这里命名不清晰”“加个测试”。

你改完继续：

```bash
git add -p
git commit -m "refactor: rename handler"
git push
```

---

## 5) PR 合并（merge）方式怎么选？

在 GitHub 的 PR 页面通常有 3 种合并按钮（仓库管理员可配置）：

1. **Create a merge commit**（保留分支结构）

   * 优点：历史能看出这是一次 PR 合并
   * 适合：团队协作、想保留完整合并关系

2. **Squash and merge**（把 PR 的多个提交压成 1 个）

   * 优点：main 历史干净（尤其 AI/试错提交很多时）
   * 适合：功能分支提交多、main 希望简洁

3. **Rebase and merge**（把 PR 的提交逐个“平铺”进 main）

   * 优点：线性历史
   * 风险：对公共历史的理解要一致，团队需要习惯

> 对“AI agent 改很多次”的 PR，我通常更推荐 **Squash and merge**，main 会更清爽、回滚也更简单。

---

## 6) 合并前如果提示冲突（Conflict）怎么办？

### 6.1 最常见做法：把 main 的最新变化同步到 feature 分支

在本地：

```bash
git checkout feature/health-endpoint
git fetch origin
git merge origin/main
```

如果出现冲突：

1. `git status` 看冲突文件
2. 用 VS Code 打开冲突文件，选择保留哪段
3. 解决后：

```bash
git add <冲突文件>
git commit -m "chore: resolve merge conflicts with main"
git push
```

回到 PR 页面，冲突就会消失，可以继续 merge。

> 如果你更喜欢线性历史，也可以用 rebase：
> `git rebase origin/main`（但 rebase 后一般要 `git push --force-with-lease`，更需要谨慎）

---

## 7) 合并完成后的本地收尾（建议养成习惯）

### 7.1 切回 main 并更新

```bash
git checkout main
git pull origin main
```

### 7.2 删除本地 feature 分支（已合并就清理）

```bash
git branch -d feature/health-endpoint
```

### 7.3 删除远程 feature 分支（可选，GitHub 也有按钮）

```bash
git push origin --delete feature/health-endpoint
```

---

## 8) VS Code 里提交 PR 与 merge（如果你装了 GitHub Pull Requests 插件）

（扩展名通常叫 **GitHub Pull Requests and Issues**）

### 创建 PR（典型路径）

* `Ctrl/Cmd + Shift + P`
* 搜索：`GitHub: Create Pull Request`
* 选择 base `main`、compare `feature/health-endpoint`
* 填标题描述 → 创建

### 在 VS Code 里看 PR diff / 评论 / Approve

* 侧边栏 GitHub 图标 → Pull Requests
* 点开 PR 可以直接看文件 diff、添加 comment、Approve/Request changes

### merge

很多情况下你也能在 VS Code 的 PR 视图里点 **Merge**（取决于权限和仓库设置）；否则回到 GitHub 网页点合并也一样。

---

如果你愿意，我可以再用你真实的项目场景“定制一个例子”：
比如你现在用的是 GitHub 还是 GitLab？main 还是 master？团队更偏好 **squash** 还是 **merge commit**？你回答一句我就按你的偏好把流程改成“你们团队标准版”。
