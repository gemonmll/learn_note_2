å¥½ï¼Œä¸‹é¢æˆ‘**å®Œå…¨åŸºäºä½ ç»™çš„è¿™ä¸ª `simpleBind.h`**ï¼Œå†™ä¸€ä¸ª**æœ€å°ã€å®Œæ•´ã€å¯å¯¹ç…§çš„ä½¿ç”¨ç¤ºä¾‹**ï¼Œä¸€æ­¥ä¸€æ­¥è¯´æ˜ **è¿™ä¸ª `simplebind` åˆ°åº•æ€ä¹ˆç”¨ã€å‘ç”Ÿäº†ä»€ä¹ˆ**ã€‚

æˆ‘ä¼šå°½é‡è´´è¿‘ä½ ç°åœ¨çš„å·¥ç¨‹å†™æ³•ï¼Œè€Œä¸æ˜¯â€œæ•™æå¼â€ã€‚

---

## ä¸€ã€å…ˆæ˜ç¡®ï¼šè¿™ä¸ª bind è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ

ç›®æ ‡æ˜¯æŠŠï¼š

```cpp
æŸä¸ªå¯¹è±¡ + å®ƒçš„æˆå‘˜å‡½æ•°
```

ç»‘å®šæˆä¸€ä¸ªï¼š

```cpp
FunObj*
```

ç„¶åäº¤ç»™ `CTrigger`ï¼Œç”± `event` è§¦å‘è°ƒç”¨ã€‚

---

## äºŒã€ä¸€ä¸ªæœ€å°å¯ç”¨ç¤ºä¾‹ï¼ˆå®Œæ•´ï¼‰

### 1ï¸âƒ£ å®šä¹‰ä¸€ä¸ªä¸šåŠ¡ Handlerï¼ˆç»§æ‰¿ CHandler<T>ï¼‰

```cpp
#include "simpleBind.h"
#include <iostream>

using namespace FRAMEWORK;

class FusionResHandler : public CHandler<FusionResHandler>
{
public:
    void OnRecvRes(int32_t event, void* obj, uint64_t tick)
    {
        std::cout << "[FusionResHandler] OnRecvRes, event="
                  << event << ", tick=" << tick << std::endl;
    }

    void OnRecvHmiRes(int32_t event, void* obj, uint64_t tick)
    {
        std::cout << "[FusionResHandler] OnRecvHmiRes, event="
                  << event << ", tick=" << tick << std::endl;
    }
};
```

ğŸ“Œ **å…³é”®ç‚¹**

```cpp
class FusionResHandler : public CHandler<FusionResHandler>
```

è¿™ä¸€æ­¥ï¼š

* ç»™ `FusionResHandler` æ³¨å…¥äº†ï¼š

```cpp
circleVector<FunObjT<FusionResHandler>, MAX_HANDLER_NUM> m_funobjs;
```

---

## ä¸‰ã€bind + äº‹ä»¶æ³¨å†Œï¼ˆé‡ç‚¹ï¼‰

### 2ï¸âƒ£ åˆ›å»º Trigger å’Œ Handler

```cpp
int main()
{
    CTrigger trigger;
    FusionResHandler handler;
```

---

### 3ï¸âƒ£ ä½¿ç”¨ simplebind ç»‘å®šæˆå‘˜å‡½æ•°

```cpp
    // ç»‘å®š OnRecvRes
    FunObj* fo1 = simplebind(
        &FusionResHandler::OnRecvRes,
        &handler
    );

    // ç»‘å®š OnRecvHmiRes
    FunObj* fo2 = simplebind(
        &FusionResHandler::OnRecvHmiRes,
        &handler
    );
```

### è¿™è¡Œä»£ç **éå¸¸é‡è¦**

```cpp
simplebind(&FusionResHandler::OnRecvRes, &handler);
```

å®ƒç­‰ä»·äºï¼ˆè¯­ä¹‰ä¸Šï¼‰ï¼š

> â€œåœ¨ handler å†…éƒ¨åˆ›å»ºä¸€ä¸ª FunObjT<FusionResHandler>ï¼Œ
> ä¿å­˜ handler æŒ‡é’ˆ + OnRecvRes æˆå‘˜å‡½æ•°æŒ‡é’ˆï¼Œ
> è¿”å›ä¸€ä¸ª FunObj*â€

---

### 4ï¸âƒ£ æŠŠå›è°ƒæŒ‚åˆ°äº‹ä»¶ä¸Š

```cpp
    trigger.AddEventHandler(fo1, 1001); // EVENT_FUSION_DDSFLOW
    trigger.AddEventHandler(fo2, 1002); // EVENT_FUSION_HMI
```

æ­¤æ—¶ `CTrigger` é‡Œå­˜çš„æ˜¯ï¼š

```text
event = 1001 -> FunObj* (OnRecvRes)
event = 1002 -> FunObj* (OnRecvHmiRes)
```

---

## å››ã€è§¦å‘äº‹ä»¶ï¼ˆå®Œæ•´è°ƒç”¨é“¾ï¼‰

### 5ï¸âƒ£ è§¦å‘äº‹ä»¶

```cpp
    trigger.TriggerEvent(1001, nullptr, 12345);
    trigger.TriggerEvent(1002, nullptr, 67890);
}
```

---

## äº”ã€ä¸€æ­¥ä¸€æ­¥å±•å¼€è°ƒç”¨è¿‡ç¨‹ï¼ˆéå¸¸å…³é”®ï¼‰

### â‘  TriggerEvent å†…éƒ¨

```cpp
m_event_cbs[i].cb->call_fun(event, obj, tick);
```

---

### â‘¡ è™šå‡½æ•°åˆ†å‘

`cb` å®é™…ç±»å‹æ˜¯ï¼š

```cpp
FunObjT<FusionResHandler>
```

è°ƒç”¨ï¼š

```cpp
FunObjT<FusionResHandler>::call_fun(...)
```

---

### â‘¢ FunObjT::call_fun

```cpp
(obj_ptr->*fun_ptr)(event, obj, tick);
```

å±•å¼€ä¸ºï¼š

```cpp
(handler.*&FusionResHandler::OnRecvRes)(event, obj, tick);
```

---

### â‘£ å‘½ä¸­ä¸šåŠ¡ä»£ç 

```cpp
FusionResHandler::OnRecvRes(...)
```

ğŸ¯ **æ•´ä¸ªé“¾è·¯å®Œæˆ**

---

## å…­ã€æŠŠ simplebind æ‹†å¼€â€œç™½ç›’ç†è§£â€

```cpp
template <class T>
FunObj *simplebind(typename FunObjT<T>::pMemFunc func_ptr, T *ptr)
{
    // 1ï¸âƒ£ åœ¨ handler.m_funobjs é‡Œæ„é€ ä¸€ä¸ª FunObjT<T>
    auto it = ptr->m_funobjs.emplace_back_itor();

    // 2ï¸âƒ£ è®°å½•æˆå‘˜å‡½æ•°
    it->fun_ptr = func_ptr;

    // 3ï¸âƒ£ è®°å½•å¯¹è±¡
    it->obj_ptr = ptr;

    // 4ï¸âƒ£ è¿”å› FunObj*ï¼ˆç±»å‹æ“¦é™¤ï¼‰
    return it.operator->();
}
```

ğŸ“Œ **æ³¨æ„ï¼š**

* âŒ æ²¡æœ‰ new
* âŒ æ²¡æœ‰ delete
* âŒ æ²¡æœ‰ std::function
* âœ… å›ºå®šå®¹é‡
* âœ… å®æ—¶å®‰å…¨

---

## ä¸ƒã€å¦‚æœä½ ä¸ç”¨ simplebindï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

ä½ éœ€è¦è‡ªå·±å†™ï¼š

```cpp
FunObjT<FusionResHandler>* fo =
    new FunObjT<FusionResHandler>(&handler, &FusionResHandler::OnRecvRes);
```

ä½†ä½ ä»¬è¿™ä¸ªæ¡†æ¶ **æ˜ç¡®ç¦æ­¢å †åˆ†é…**ï¼Œæ‰€ä»¥ `simplebind` æ˜¯**å”¯ä¸€æ­£ç¡®å…¥å£**ã€‚

---

## å…«ã€å’Œä½ æœ€æ—©é‚£ä¸ª FusionResHandler çš„å…³ç³»

ä½ æœ€æ—©çš„ä»£ç ï¼š

```cpp
void OnRecvRes(...)
{
    TriggerEvent(m_h, EVENT_FUSION_DDSFLOW, obj);
}
```

ç°åœ¨ä½ åº”è¯¥èƒ½ç†è§£ï¼š

* `simplebind` è´Ÿè´£ **æŠŠ OnRecvXXX æ¥è¿›æ¡†æ¶**
* `CTrigger` è´Ÿè´£ **æŒ‰ event è°ƒç”¨**
* `CHandler<T>` è´Ÿè´£ **å›è°ƒå¯¹è±¡ç”Ÿå‘½å‘¨æœŸ**

---

## ä¹ã€ä¸€å¥è¯æ€»ç»“ï¼ˆéå¸¸é‡è¦ï¼‰

> **simplebind çš„æœ¬è´¨æ˜¯ï¼š
> åœ¨ Handler è‡ªå·±çš„å›è°ƒæ± é‡Œåˆ›å»ºä¸€ä¸ªâ€œå¯¹è±¡ + æˆå‘˜å‡½æ•°â€çš„ FunObjï¼Œ
> è¿”å› FunObj* ç»™äº‹ä»¶ç³»ç»Ÿä½¿ç”¨ã€‚**

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ï¼š

* ç”¨ **ä½ çœŸå®çš„ FusionResHandler + EVENT_FUSION_xxx** å†å†™ä¸€ä¸ªè´´è¿‘å·¥ç¨‹çš„ä¾‹å­
* æˆ–ç”»ä¸€å¼  **bind â†’ trigger â†’ call çš„æ—¶åºå›¾**
* æˆ–å¸®ä½ åˆ†æ **MAX_HANDLER_NUM / MAX_EVENT_NUM çš„è®¾è®¡å–èˆ**

ä½ é€‰ä¸€ä¸ªï¼Œæˆ‘ç»§ç»­å¾€ä¸‹æ‹†ã€‚
