ä½ çš„ç†è§£å·²ç»æ¥è¿‘æ­£ç¡®äº†ï¼Œä½†è¿˜æœ‰ä¸€ç‚¹å…³é”®ä¹‹å¤„éœ€è¦å¼„æ¸…æ¥šï¼š

> **ä»å®¹å™¨å†…éƒ¨ `std::move(buf_)` åˆ°å¤–éƒ¨è¿”å›å€¼ä¹‹é—´çš„â€œæ‰€æœ‰æƒç§»åŠ¨â€å’Œâ€œå¯¹è±¡çŠ¶æ€â€åˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ**

æˆ‘ä¼šä¸€æ­¥ä¸€æ­¥å¸¦ä½ å½»åº•ç†è§£ï¼š

---

# âœ… 1. `return std::move(buf_);` å¹¶ä¸æ˜¯è®© buf_ â€œæ¶ˆå¤±â€

å®ƒçš„çœŸæ­£å«ä¹‰æ˜¯ï¼š

> **æŠŠå†…éƒ¨ `buf_` çš„èµ„æºï¼ˆå®¹é‡ã€æŒ‡é’ˆï¼‰ç§»åŠ¨åˆ°å¤–éƒ¨è¿”å›å€¼ä¸­ã€‚**
> **ä½† builder ä¸­çš„ buf_ ä¾ç„¶å­˜åœ¨ï¼Œåªæ˜¯å¤„äºâ€œç©ºå£³ / æœ‰æ•ˆä½†æœªæŒ‡å®šçŠ¶æ€â€ã€‚**

ä¸¾ä¾‹ï¼š

builder å†…éƒ¨åŸæ¥æœ‰ï¼š

```
buf_:
  data -> "ABCDEF"
  size = 6
  capacity = 8
```

æ‰§è¡Œï¼š

```cpp
return std::move(buf_);
```

ä¹‹åï¼š

```
è¿”å›å€¼ string:
  data -> åŸæ¥ buf_ çš„å†…å­˜ï¼ˆç›´æ¥æ¬è¿‡å»ï¼‰
  size = 6
  capacity = 8

builder.buf_:
  data -> ""ï¼ˆå®ç°æœªæŒ‡å®šï¼Œä½†ä¿è¯å¯ææ„ï¼‰
  size = 0
  capacity = 0  æˆ–è€…æŸç§â€œæœªæŒ‡å®šçŠ¶æ€â€
```

**ç§»åŠ¨åçš„ builder.buf_ ä¸ä¼šå´©æºƒï¼Œä½†ä¸èƒ½å†ç»§ç»­ä½¿ç”¨ã€‚**

---

# ğŸ” 2. è¿”å›çš„ `std::string` æ˜¯å³å€¼ï¼Ÿå·¦å€¼ï¼Ÿæ€ä¹ˆç†è§£ï¼Ÿ

å½“ä½ å†™ï¼š

```cpp
std::string s = std::move(builder).build();
```

build() è¿”å›çš„æ˜¯ä¸€ä¸ª **ä¸´æ—¶çš„ç§»åŠ¨æ„é€ è¿”å›å€¼ï¼ˆå³å€¼ï¼‰**ã€‚
ç„¶åè¿™ä¸ªå³å€¼è¢«ç”¨äºåˆå§‹åŒ– sï¼ˆè§¦å‘ç§»åŠ¨æ„é€ ï¼‰ã€‚

æ‰€ä»¥è¿‡ç¨‹å¦‚ä¸‹ï¼š

```
builder.buf_ --move--> build() è¿”å›å€¼ string(ä¸´æ—¶å¯¹è±¡)
build()è¿”å›å€¼ string(ä¸´æ—¶å¯¹è±¡) --move--> s
```

**æ•´ä¸ªè¿‡ç¨‹ä¸­æ²¡æœ‰ä»»ä½•æ‹·è´ï¼å…¨éƒ¨æ˜¯ç§»åŠ¨æ„é€ ï¼**

---

# ğŸ¯ 3. ä¸ºä»€ä¹ˆ build() è¦é™å®šä¸º `&&`ï¼ˆå³å€¼æ–¹æ³•ï¼‰ï¼Ÿ

å› ä¸ºï¼š

> build() ä¼šâ€œæç©ºâ€ builder çš„å†…éƒ¨æ•°æ®ï¼Œä½¿ builder å¤±æ•ˆ
> æ‰€ä»¥åªå…è®¸ builder æ˜¯å³å€¼ï¼ˆå³å°†è¢«é”€æ¯çš„å¯¹è±¡ï¼‰

å†™æ³•ï¼š

```cpp
MsgBuilder builder;
builder.build();      // âŒ ä¸å®‰å…¨ï¼Œbuilder è¿˜æ´»ç€ï¼Œä½†è¢«æ¸…ç©ºäº†
std::move(builder).build(); // âœ” builder å°†è¢«åºŸå¼ƒï¼Œå®‰å…¨
```

è¿™å°±æ˜¯ä¸ºä½•å†™æˆï¼š

```cpp
std::string build() &&;
```

ä½ å¿…é¡»ä»¥å³å€¼è°ƒç”¨ï¼š

```cpp
std::string buf = std::move(builder).build();
```

---

# ğŸ§± 4. è¿”å›çš„ string ä¸ºä»€ä¹ˆä¸æ˜¯å³å€¼ï¼Ÿ

è¿™æ­£æ˜¯ C++ çš„è¯­ä¹‰ï¼š

### build() è¿”å›çš„ string **æ˜¯å³å€¼**

å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ã€‚

ä½†ä½ çš„ä»£ç ï¼š

```cpp
std::string buf = std::move(builder).build();
```

æŠŠè¿™ä¸ªå³å€¼ç”¨æ¥åˆå§‹åŒ– bufï¼Œbuf æ˜¯ä¸€ä¸ªå·¦å€¼å¯¹è±¡ï¼Œæ²¡é—®é¢˜ã€‚

**å³å€¼æ„é€ å·¦å€¼æœ¬æ¥å°±æ˜¯åˆæ³•æ“ä½œã€‚**
å³å€¼ â†’ ç§»åŠ¨æ„é€  â†’ å·¦å€¼ï¼Œå®Œå…¨æ­£å¸¸ã€‚

---

# ğŸ§  5. æœ€å®Œæ•´çš„æ‰§è¡Œæµç¨‹ï¼ˆå…³é”®ï¼‰

### ç¬¬ä¸€æ­¥ï¼šbuilder æ˜¯å·¦å€¼

ä¸èƒ½è°ƒç”¨ build()ã€‚

### ç¬¬äºŒæ­¥ï¼šstd::move(builder)

å˜æˆå³å€¼ã€‚

### ç¬¬ä¸‰æ­¥ï¼šè°ƒç”¨ build() &&

### ç¬¬å››æ­¥ï¼šbuild() å†…éƒ¨ï¼š

```cpp
return std::move(buf_);
```

ç”Ÿæˆä¸€ä¸ªä¸´æ—¶ stringï¼ˆå³å€¼ï¼‰ã€‚

### ç¬¬äº”æ­¥ï¼šè¿™ä¸´æ—¶ string ä½œä¸ºæ„é€ å‚æ•°

**ç§»åŠ¨æ„é€ ** æœ€ç»ˆå˜é‡ bufã€‚

æ•´ä¸ªé“¾è·¯éƒ½æ˜¯ä¼˜åŒ–è¿‡çš„ï¼š

* **buf_ çš„å†…å­˜åªç§»åŠ¨ï¼Œä¸æ‹·è´**
* buf_ å˜æˆâ€œç©ºå£³çŠ¶æ€â€
* builder æ•´ä½“é©¬ä¸Šè¦è¢«é”€æ¯ï¼ˆåˆç†ï¼‰

è¿™æ˜¯ C++11 è®¾è®¡ç§»åŠ¨è¯­ä¹‰çš„å…¸å‹åœºæ™¯ã€‚

---

# ğŸ§© 6. æ€»ç»“ä¸€å¥è¯

### build() && çš„è®¾è®¡ç†å¿µï¼š

1. **å³å€¼é™å®šç¬¦**ï¼šé˜²æ­¢ build() è¢«è¯¯ç”¨ï¼ˆåªå…è®¸å³å€¼ builder è°ƒç”¨ï¼‰
2. **è¿”å›å€¼ std::move(buf_)**ï¼šæŠŠå†…éƒ¨ buffer é«˜æ•ˆç§»åŠ¨å‡ºæ¥
3. **builder çš„ buf_ ä¼šè¢«è€—å°½**ï¼ˆä½†ä¸ä¼šå´©ï¼‰
4. **å¤–éƒ¨æ¥æ”¶çš„æ˜¯â€œå³å€¼æ„é€ â€çš„ std::stringï¼ˆé«˜æ•ˆï¼‰**

æœ€åå¤–éƒ¨å¾—åˆ°çš„æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ std::stringï¼ˆå·¦å€¼ï¼‰ï¼Œè¿™æ˜¯å®Œå…¨åˆç†çš„ã€‚

---

# ğŸ‰ æƒ³æ›´æ¸…æ™°å—ï¼Ÿ

æˆ‘å¯ä»¥ç»™ä½ ç”»ä¸€å¼ â€œå†…å­˜å›¾æµåŠ¨â€çš„å›¾ï¼Œè®©ä½ ä»è§†è§‰ä¸Šçœ‹åˆ°ï¼š

```
builder.buf_ ----move---> ä¸´æ—¶è¿”å›å€¼ ----move---> æœ€ç»ˆ std::string
```

ä½ è¦å—ï¼Ÿ


