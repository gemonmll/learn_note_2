å¤ªå¥½äº† ğŸ‘
è¿™ä¸ªå›¾ä¼šè®©ä½ â€œä¸€çœ¼å°±çœ‹æ‡‚â€ ROS2 å›è°ƒæœºåˆ¶ï¼ˆ`std::function` + `std::bind` + lambdaï¼‰çš„è¿è¡Œé€»è¾‘ã€‚
æˆ‘ä»¬ä¸€æ­¥æ­¥çœ‹ï¼š

---

## ğŸ§© ä¸€ã€å…ˆçœ‹æœ€å¸¸è§çš„ ROS2 å†™æ³•

```cpp
timer_ = this->create_wall_timer(
    500ms,
    std::bind(&MinimalPublisher::timer_callback, this)
);
```

`timer_callback()` æ˜¯ç±»çš„æˆå‘˜å‡½æ•°ï¼Œ
`create_wall_timer()` éœ€è¦ä¸€ä¸ª **std::function<void()>** ç±»å‹çš„å›è°ƒã€‚

é—®é¢˜ï¼š

> æˆå‘˜å‡½æ•°æœ‰ä¸€ä¸ªéšå«çš„å‚æ•° `this`ï¼Œæ€ä¹ˆæ‰èƒ½å˜æˆæ™®é€šå‡½æ•°ä¸€æ ·çš„æ¥å£ï¼Ÿ

ç­”æ¡ˆï¼š

> ç”¨ `std::bind` æŠŠæˆå‘˜å‡½æ•°å’Œå¯¹è±¡ç»‘å®šåœ¨ä¸€èµ·ï¼

---

## ğŸ§  äºŒã€é€»è¾‘åˆ†å±‚å›¾

ä¸‹é¢æ˜¯ä¸€å¼ æ–‡å­—ç‰ˆçš„â€œè°ƒç”¨å…³ç³»å›¾â€ ğŸ‘‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ rclcpp::TimerBase ï¼ˆå®šæ—¶å™¨å†…éƒ¨é€»è¾‘ï¼‰       â”‚
â”‚   â””â”€â”€ ä¿å­˜ï¼šstd::function<void()> callback  â”‚
â”‚         â”‚                                   â”‚
â”‚         â–¼                                   â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚     â”‚ std::function<void()>        â”‚        â”‚
â”‚     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”‚        â”‚
â”‚     â”‚  æŒæœ‰ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼š        â”‚        â”‚
â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚        â”‚
â”‚     â”‚  â”‚ std::_Bind<...> å¯¹è±¡ â”‚   â”‚        â”‚
â”‚     â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚   â”‚        â”‚
â”‚     â”‚  â”‚ å†…éƒ¨ä¿å­˜ï¼š           â”‚   â”‚        â”‚
â”‚     â”‚  â”‚   &MinimalPublisher::timer_callback â”‚
â”‚     â”‚  â”‚   thisï¼ˆå¯¹è±¡æŒ‡é’ˆï¼‰     â”‚   â”‚        â”‚
â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚        â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ”¹ å½“ ROS2 çš„å®šæ—¶å™¨è§¦å‘æ—¶ï¼Œå®ƒå°±æ‰§è¡Œï¼š
>
> ```cpp
> callback();   // std::function è°ƒç”¨
> ```
>
> ğŸ”¹ `std::function` å†…éƒ¨å®é™…ä¸Šä¼šè½¬å‘ç»™ï¼š
>
> ```cpp
> std::_Bind::operator()();   // è°ƒç”¨è¢«ç»‘å®šçš„å‡½æ•°å¯¹è±¡
> ```
>
> ğŸ”¹ æœ€ç»ˆå®ƒä¼šè‡ªåŠ¨å±•å¼€æˆï¼š
>
> ```cpp
> this->timer_callback();
> ```

---

## ğŸ§© ä¸‰ã€å¦‚æœæ¢æˆ lambda è¡¨è¾¾å¼

ä»£ç å˜æˆï¼š

```cpp
auto timer_callback = [this]() {
  this->timer_callback();
};
timer_ = this->create_wall_timer(500ms, timer_callback);
```

å›¾ç¤ºå˜ä¸º ğŸ‘‡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ std::function<void()> callback      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚ å†…éƒ¨æŒæœ‰ï¼šlambda å¯¹è±¡               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ captures: this             â”‚    â”‚
â”‚   â”‚ operator() {               â”‚    â”‚
â”‚   â”‚   this->timer_callback();  â”‚    â”‚
â”‚   â”‚ }                          â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> è¿™é‡Œå…¶å®è·Ÿ `std::bind` çš„åŸç†å‡ ä¹ä¸€æ ·ï¼Œ
> åŒºåˆ«åªæ˜¯ï¼š
>
> * `std::bind` ç”¨æ¨¡æ¿å’Œå ä½ç¬¦ `_1`, `_2` å®ç°ï¼›
> * lambda æ˜¯è¯­æ³•ç³–ï¼Œç¼–è¯‘å™¨è‡ªåŠ¨ç”ŸæˆåŒæ ·çš„ç»“æ„ã€‚

---

## ğŸ§© å››ã€ç±»æˆå‘˜å‡½æ•°ä¸ºä»€ä¹ˆå¿…é¡»ç”¨ `bind` æˆ– lambdaï¼Ÿ

å› ä¸ºæˆå‘˜å‡½æ•°ä¸æ˜¯æ™®é€šå‡½æ•°ï¼š

```cpp
void MinimalPublisher::timer_callback();
```

çš„çœŸå®å‡½æ•°ç±»å‹æ˜¯ï¼š

```cpp
void (MinimalPublisher::*)();
```

ä¹Ÿå°±æ˜¯â€œæŒ‡å‘ç±»æˆå‘˜å‡½æ•°çš„æŒ‡é’ˆâ€ï¼Œ
**è°ƒç”¨æ—¶å¿…é¡»çŸ¥é“å±äºå“ªä¸ªå¯¹è±¡**ï¼ˆå³ `this`ï¼‰ã€‚

ä¸¾ä¾‹ï¼š

```cpp
MinimalPublisher node;
auto f = &MinimalPublisher::timer_callback; // f åªæ˜¯å‡½æ•°åœ°å€
(node.*f)(); // å¿…é¡»ç”¨å¯¹è±¡è°ƒç”¨
```

è€Œ `std::bind(&MinimalPublisher::timer_callback, &node)`
å°±ä¼šç”Ÿæˆä¸€ä¸ªâ€œå·²ç»çŸ¥é“å¯¹è±¡æ˜¯è°â€çš„æ–°å‡½æ•°ï¼š

```cpp
std::function<void()> callback = [node]() { node.timer_callback(); };
```

è¿™æ · `callback()` å°±èƒ½ç›´æ¥è°ƒç”¨ï¼Œä¸å†éœ€è¦å¯¹è±¡ä¿¡æ¯ã€‚

---

## ğŸ§© äº”ã€ä¸‰ç§å¸¸è§æ–¹å¼æ¯”è¾ƒ

| æ–¹å¼        | å†™æ³•                                     | ç‰¹ç‚¹                     |
| --------- | -------------------------------------- | ---------------------- |
| æ™®é€šå‡½æ•°      | `std::function<void()> f = foo;`       | æœ€ç®€å•ï¼Œä½†åªèƒ½ç”¨æ™®é€šå‡½æ•°           |
| lambda    | `[this]() { this->timer_callback(); }` | ç°ä»£å†™æ³•ï¼Œå¯æ•è·ä¸Šä¸‹æ–‡            |
| std::bind | `std::bind(&Class::func, this)`        | é€šç”¨å†™æ³•ï¼Œæ”¯æŒå¤šå‚æ•°ä¸ `_1`, `_2` |

---

## ğŸ§© å…­ã€è¡¥å……å›¾ï¼šå®Œæ•´è°ƒç”¨é“¾

ä»¥ ROS2 å®šæ—¶å™¨ä¸ºä¾‹ ğŸ‘‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ROS2 Timer â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ (è§¦å‘)
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ std::functionâ”‚
â”‚ callback()   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ std::bind   â”‚
â”‚ è°ƒç”¨ä¿å­˜çš„æˆå‘˜å‡½æ•° â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MinimalPublisher å¯¹è±¡ â”‚
â”‚ â†’ è°ƒç”¨ timer_callback()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© ä¸ƒã€æ€»ç»“å£è¯€

> âœ… **`std::function`**ï¼šè£…â€œèƒ½è¢«è°ƒç”¨çš„ä»»ä½•ä¸œè¥¿â€
> âœ… **`std::bind`**ï¼šæŠŠâ€œå‡½æ•° + å‚æ•°ï¼ˆæˆ–å¯¹è±¡ï¼‰â€æ‰“åŒ…èµ·æ¥
> âœ… **`lambda`**ï¼š`std::bind` çš„è¯­æ³•ç³–
> âœ… **ROS2 å›è°ƒ**ï¼šç”¨ `std::function` å­˜å‚¨ï¼Œç”¨ `bind/lambda` æ„é€ 

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç”Ÿæˆä¸€ä¸ª **å›¾å½¢åŒ–ç‰ˆæœ¬ï¼ˆæ¡†çº¿å›¾æˆ–ç®­å¤´å›¾ï¼‰**ï¼Œ
è®©ä½ çœ‹å‡ºï¼š

> â€œstd::functionâ€ å†…éƒ¨è£…ç€è°ï¼Œâ€œstd::bindâ€ åˆæ˜¯æ€ä¹ˆæŠŠå¯¹è±¡å¡è¿›å»çš„ã€‚

è¦æˆ‘å¸®ä½ ç”»é‚£ä¸ªå›¾å—ï¼Ÿ
