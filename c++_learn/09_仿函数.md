éå¸¸æ£’çš„æé—®ğŸ‘â€”â€”
**â€œä»¿å‡½æ•°ï¼ˆfunctorï¼‰â€** æ˜¯ C++ é‡Œä¸€ä¸ªéå¸¸æ ¸å¿ƒä½†ç»å¸¸è¢«å¿½è§†çš„æ¦‚å¿µï¼Œ
è€Œä¸”å®ƒæ­£æ˜¯ä½ åˆšåˆšå­¦åˆ°çš„ `std::function`ã€`std::bind`ã€lambda èƒŒåçš„åŸºç¡€ã€‚

---

## ğŸ§© ä¸€ã€ä»€ä¹ˆæ˜¯ä»¿å‡½æ•°ï¼ˆFunctorï¼‰

**å®šä¹‰ä¸€å¥è¯ï¼š**

> ä»¿å‡½æ•°æ˜¯ä¸€ä¸ªâ€œåƒå‡½æ•°ä¸€æ ·å¯ä»¥è¢«è°ƒç”¨çš„å¯¹è±¡â€ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒ**ä¸æ˜¯å‡½æ•°**ï¼Œä½†ä½ å¯ä»¥ç”¨ `()` è°ƒç”¨å®ƒã€‚
å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª **å®šä¹‰äº† `operator()` çš„ç±»ï¼ˆæˆ–ç»“æ„ä½“ï¼‰å¯¹è±¡**ã€‚

---

### ğŸ”¹ ä¸¾ä¸ªä¾‹å­ï¼š

```cpp
#include <iostream>

struct Add
{
    int operator()(int a, int b) const
    {
        return a + b;
    }
};

int main()
{
    Add add;              // åˆ›å»ºä¸€ä¸ªå¯¹è±¡
    int result = add(2, 3); // åƒå‡½æ•°ä¸€æ ·è°ƒç”¨ï¼
    std::cout << result;  // è¾“å‡º 5
}
```

ğŸ” è§£é‡Šï¼š

* `Add` æ˜¯ä¸€ä¸ªç±»ï¼›
* `operator()` è®© `Add` çš„å¯¹è±¡å¯ä»¥è¢«â€œè°ƒç”¨â€ï¼›
* æ‰€ä»¥ `add(2, 3)` å®é™…ä¸Šç­‰ä»·äº `add.operator()(2, 3)`ã€‚

---

## ğŸ§  äºŒã€ä¸ºä»€ä¹ˆå«â€œä»¿å‡½æ•°â€ï¼Ÿ

å› ä¸ºå®ƒâ€œä»¿é€ â€äº†å‡½æ•°çš„è°ƒç”¨å½¢å¼ã€‚

> â€œä»¿å‡½æ•°â€ = â€œfunction objectâ€ = â€œå‡½æ•°å¯¹è±¡â€

---

## ğŸ§© ä¸‰ã€ä»¿å‡½æ•°çš„ä¼˜åŠ¿

| ä¼˜åŠ¿        | è¯´æ˜                        |
| --------- | ------------------------- |
| âœ… å¯æºå¸¦çŠ¶æ€   | æ¯”å¦‚åœ¨å¯¹è±¡é‡Œå­˜å‚æ•°ã€è®¡æ•°ã€æ—¥å¿—ç­‰          |
| âœ… å¯å†…è”ä¼˜åŒ–   | ç¼–è¯‘å™¨æ¯”æ™®é€šå‡½æ•°æŒ‡é’ˆæ›´å®¹æ˜“ä¼˜åŒ–           |
| âœ… å¯ä½œä¸ºæ¨¡æ¿å‚æ•° | STL ç®—æ³•ï¼ˆsortã€for_eachï¼‰å¤§é‡ä½¿ç”¨ |
| âœ… å¯æ›¿ä»£å‡½æ•°æŒ‡é’ˆ | æ¯”å‡½æ•°æŒ‡é’ˆæ›´çµæ´»ã€å®‰å…¨ã€å¯å®šåˆ¶           |

---

### ğŸ”¹ ä¸¾ä¸ªå¸¦çŠ¶æ€çš„ä¾‹å­ï¼š

```cpp
#include <iostream>

struct MultiplyBy
{
    int factor;
    MultiplyBy(int f) : factor(f) {}

    int operator()(int x) const
    {
        return x * factor;
    }
};

int main()
{
    MultiplyBy times3(3);
    std::cout << times3(10); // è¾“å‡º 30
}
```

ğŸ’¡ ä½ çœ‹ï¼Œè¿™ä¸ªå¯¹è±¡ `times3` è®°ä½äº†ä¸€ä¸ªâ€œçŠ¶æ€â€ï¼ˆfactor = 3ï¼‰ï¼Œ
è¿™å°±æ˜¯ä»¿å‡½æ•°æ¯”æ™®é€šå‡½æ•°å¼ºå¤§çš„åœ°æ–¹ã€‚

---

## ğŸ§© å››ã€åœ¨ STL ä¸­çš„åº”ç”¨

C++ STLï¼ˆæ ‡å‡†æ¨¡æ¿åº“ï¼‰å¤§é‡ä½¿ç”¨ä»¿å‡½æ•°ã€‚

æ¯”å¦‚ï¼š

```cpp
#include <algorithm>
#include <vector>
#include <functional>  // å†…ç½®ä»¿å‡½æ•°å®šä¹‰åœ¨è¿™é‡Œ

int main()
{
    std::vector<int> v = {1, 2, 3};

    // ä½¿ç”¨ std::plus<int> ä»¿å‡½æ•°
    int sum = std::accumulate(v.begin(), v.end(), 0, std::plus<int>());

    // ä½¿ç”¨ std::greater<int> ä»¿å‡½æ•°
    std::sort(v.begin(), v.end(), std::greater<int>());
}
```

ğŸ”¹ `std::plus<int>`ã€`std::greater<int>` éƒ½æ˜¯ STL æä¾›çš„ä»¿å‡½æ•°ã€‚
å®ƒä»¬çš„ä½œç”¨å°±åƒâ€œå‡½æ•°æŒ‡é’ˆâ€ï¼Œä½†ç±»å‹å®‰å…¨åˆå¯å†…è”ä¼˜åŒ–ã€‚

---

## ğŸ§© äº”ã€ä»¿å‡½æ•°ã€lambdaã€std::function çš„å…³ç³»

è¿™ä¸‰è€…å…¶å®æ˜¯ä¸€æ¡â€œè¿›åŒ–é“¾â€ï¼š

| åç§°                | æœ¬è´¨                   | ç¤ºä¾‹                                              | è¯´æ˜        |
| ----------------- | -------------------- | ----------------------------------------------- | --------- |
| **ä»¿å‡½æ•°**           | å®šä¹‰ `operator()` çš„ç±»å¯¹è±¡ | `struct Add { int operator()(int a, int b); };` | æœ€åŸºç¡€çš„å½¢å¼    |
| **lambda è¡¨è¾¾å¼**    | ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ä»¿å‡½æ•°          | `[x](int y){return x+y;}`                       | è¯­æ³•ç³–ï¼Œæ›´æ–¹ä¾¿   |
| **std::function** | å­˜å‚¨ä»»æ„â€œå¯è°ƒç”¨å¯¹è±¡â€çš„å®¹å™¨       | `std::function<int(int,int)> f = Add();`        | ç»Ÿä¸€æ¥å£ï¼Œé€šç”¨åŒ…è£… |

---

### ğŸ”¹ lambda å°±æ˜¯ä¸€ä¸ªâ€œåŒ¿åä»¿å‡½æ•°â€ï¼

ä¾‹å¦‚ï¼š

```cpp
auto lambda = [](int a, int b){ return a + b; };
```

å…¶å®ç¼–è¯‘å™¨èƒŒåœ°é‡Œä¼šç”Ÿæˆä¸€ä¸ªç±»ä¼¼çš„ç±»ï¼š

```cpp
struct __Lambda_1 {
    int operator()(int a, int b) const { return a + b; }
};
```

æ‰€ä»¥å½“ä½ å†™ï¼š

```cpp
lambda(1, 2);
```

å®é™…ä¸Šç­‰ä»·äºï¼š

```cpp
__Lambda_1() (1, 2);
```

> âœ… **lambda æ˜¯ä»¿å‡½æ•°çš„è¯­æ³•ç³–ã€‚**

---

## ğŸ§© å…­ã€å’Œ `std::function` çš„å…³ç³»

`std::function` æ˜¯ä¸€ä¸ªæ¨¡æ¿ç±»ï¼Œå®ƒå¯ä»¥â€œè£…â€ä¸‹ä»»æ„ä»¿å‡½æ•°ï¼ˆæˆ– lambdaã€å‡½æ•°æŒ‡é’ˆï¼‰ã€‚

```cpp
std::function<int(int,int)> f1 = Add();
std::function<int(int,int)> f2 = [](int a, int b){ return a + b; };
std::function<int(int,int)> f3 = std::plus<int>();
```

ä½ å¯ä»¥ç»Ÿä¸€ä½¿ç”¨ï¼š

```cpp
std::cout << f1(1,2) << f2(1,2) << f3(1,2);
```

> ğŸ’¡ æ‰€ä»¥ï¼š
>
> * ä»¿å‡½æ•°æ˜¯â€œèƒ½è¢«è°ƒç”¨çš„å¯¹è±¡â€
> * lambda æ˜¯â€œåŒ¿åçš„ä»¿å‡½æ•°â€
> * `std::function` æ˜¯â€œèƒ½è£…ä»»ä½•ä»¿å‡½æ•°çš„é€šç”¨å®¹å™¨â€

---

## ğŸ§© ä¸ƒã€åœ¨ ROS2 ä¸­å®ƒä»¬å¦‚ä½•è¿èµ·æ¥

```cpp
auto callback = [this]() { this->timer_callback(); };
```

è¿™ä¸ª lambda â†’ æ˜¯ä¸€ä¸ªä»¿å‡½æ•°å¯¹è±¡
`create_wall_timer()` â†’ æ¥æ”¶ä¸€ä¸ª `std::function<void()>`
ç¼–è¯‘å™¨è‡ªåŠ¨æŠŠè¿™ä¸ªä»¿å‡½æ•°æ”¾è¿› `std::function` ä¸­ã€‚

æœ€ç»ˆå½¢æˆï¼š

```
lambdaä»¿å‡½æ•° â†’ std::function<void()> â†’ rclcpp::TimerBase è°ƒç”¨
```

---

## ğŸ§© å…«ã€æ€»ç»“å£è¯€

| æ¦‚å¿µ            | å®šä¹‰                   | ä¸¾ä¾‹                                 |
| ------------- | -------------------- | ---------------------------------- |
| ä»¿å‡½æ•°           | å®šä¹‰ `operator()` çš„ç±»å¯¹è±¡ | `struct F { void operator()(); };` |
| lambda        | ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„åŒ¿åä»¿å‡½æ•°        | `[this]() { ... }`                 |
| std::function | é€šç”¨å¯è°ƒç”¨å¯¹è±¡å®¹å™¨            | `std::function<void()> f = ...;`   |
| std::bind     | åˆ›å»ºä»¿å‡½æ•°ï¼ˆåŒ…è£…å‡½æ•° + å‚æ•°ï¼‰     | `std::bind(&Class::func, this)`    |

---

å¦‚æœä½ æƒ³ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç”»ä¸€å¼ å›¾ï¼š
ğŸ“˜ å±•ç¤º **â€œä»ä»¿å‡½æ•° â†’ lambda â†’ std::function â†’ ROS2 callbackâ€** çš„è°ƒç”¨é“¾ç»“æ„å›¾ã€‚
è¦æˆ‘ç”»è¿™å¼ å›¾å¸®ä½ æŠŠå®ƒä»¬ä¸²èµ·æ¥å—ï¼Ÿ
