ä¸‹é¢æˆ‘ç»™ä½ ä¸€ä¸ª **ä»é›¶å¼€å§‹ã€å®Œæ•´æ¸…æ™°ã€æœ€å®ç”¨çš„ CMake build ä½¿ç”¨æ–¹æ³•æŒ‡å—**ã€‚
ä½ å¯ä»¥ç›´æ¥ç…§ç€ç”¨åœ¨ä½ çš„ Qt é¡¹ç›® / C++ é¡¹ç›® / å¤šé…ç½®é¡¹ç›®ä¸Šã€‚

æˆ‘ä¼šæŠŠç”¨æ³•æŒ‰ **æœ€å¸¸ç”¨ â†’ è¿›é˜¶ â†’ å®æˆ˜** æ–¹å¼è®²è§£ã€‚

---

# ğŸŸ¦ ä¸€ã€CMake æ„å»ºçš„åŸºæœ¬æµç¨‹ï¼ˆåªæœ‰ 3 æ­¥ï¼‰

CMake çš„æ„å»ºæµç¨‹æ°¸è¿œæ˜¯ï¼š

```
1) cmake -S <source> -B <build>   # é…ç½®ï¼ˆç”Ÿæˆæ„å»ºç³»ç»Ÿï¼‰
2) cmake --build <build>          # ç¼–è¯‘
3) cmake --install <build>        # å®‰è£…ï¼ˆå¯é€‰ï¼‰
```

å¯¹åº”ä½ çš„é¡¹ç›®ï¼š

```
cmake -S . -B build
cmake --build build
cmake --install build
```

---

# ğŸŸ¦ äºŒã€ç¬¬ä¸€æ­¥ï¼šé…ç½®é¡¹ç›®ï¼ˆcmake -S -Bï¼‰

æœ€å¸¸ç”¨å½¢å¼ï¼š

```bash
cmake -S . -B build -DCMAKE_BUILD_TYPE=Release
```

æˆ– Debugï¼š

```bash
cmake -S . -B build -DCMAKE_BUILD_TYPE=Debug
```

å‚æ•°è¯´æ˜ï¼š

| å‚æ•°                           | å«ä¹‰                          |
| ---------------------------- | --------------------------- |
| `-S .`                       | æŒ‡å®šæºç ç›®å½•ï¼ˆå½“å‰ç›®å½•ï¼‰                |
| `-B build`                   | æŒ‡å®šæ„å»ºè¾“å‡ºç›®å½•                    |
| `-DCMAKE_BUILD_TYPE=Release` | è®¾ç½®æ„å»ºç±»å‹ï¼ˆä»… Makefile/Ninja æœ‰ç”¨ï¼‰ |

---

# ğŸŸ¦ ä¸‰ã€ç¬¬äºŒæ­¥ï¼šæ„å»ºï¼ˆcmake --buildï¼‰

è¿™æ˜¯ä½ é—®çš„é‡ç‚¹ï¼š

```
cmake --build <build_dir>
```

å¯¹äºä½ çš„é¡¹ç›®ï¼š

```bash
cmake --build build
```

CMake ä¼šè‡ªåŠ¨æ ¹æ®ç¯å¢ƒé€‰æ‹©åˆé€‚çš„æ„å»ºå·¥å…·ï¼š

* Linux é»˜è®¤ä½¿ç”¨ `make` æˆ– `ninja`
* Windows é»˜è®¤ä½¿ç”¨ `MSBuild.exe`ï¼ˆå¦‚æœæ˜¯ VSï¼‰
* Xcode åˆ™ä½¿ç”¨ `xcodebuild`

ä½ ä¸éœ€è¦å…³å¿ƒä½¿ç”¨çš„æ˜¯ make è¿˜æ˜¯ ninjaã€‚

---

# ğŸŸ© 3.1 æŒ‡å®šç›®æ ‡ï¼ˆtargetï¼‰

ä¾‹å¦‚æ„å»ºä½ é¡¹ç›®ä¸­çš„æŸä¸ª targetï¼š

```bash
cmake --build build --target QtStartUpApplication
```

æˆ–æ„å»ºä½ æåˆ°çš„ targetï¼š

```
cmake --build build --target package_3rd_binaries
```

---

# ğŸŸ§ 3.2 æŒ‡å®šå¹¶è¡Œæ•°é‡

é»˜è®¤æŒ‰ CPU æ ¸æ•°è‡ªåŠ¨é€‰æ‹©
ä½†ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šï¼š

```
cmake --build build -j8
```

---

# ğŸŸ¦ å››ã€ç¬¬ä¸‰æ­¥ï¼ˆå¯é€‰ï¼‰ï¼šå®‰è£…ï¼ˆcmake --installï¼‰

å¦‚æœä½ å†™äº† install() æŒ‡ä»¤ï¼š

```bash
cmake --install build --prefix out/
```

è¿™æ ·ä½ çš„ runtime + 3rd å°±ä¼šè¢«å¤åˆ¶åˆ° out/ ç›®å½•ã€‚

---

# ğŸŸ© äº”ã€å¸¸è§é«˜é˜¶ç”¨æ³•

## ä½¿ç”¨ ninja ä½œä¸ºæ„å»ºå·¥å…·ï¼š

```bash
cmake -S . -B build -G Ninja
cmake --build build
```

---

## æ„å»ºå¤šä¸ªé…ç½®ï¼ˆä»… Windows å¤šé…ç½®ç”Ÿæˆå™¨ï¼‰

```bash
cmake --build build --config Release
cmake --build build --config Debug
```

---

## æ˜¾ç¤ºçœŸå®çš„ç¼–è¯‘å‘½ä»¤

```bash
cmake --build build -- VERBOSE=1
```

å¯çœ‹åˆ°ï¼š

```
/usr/bin/g++ -o main.cpp ...
```

---

# ğŸŸ¦ å…­ã€ä½ çš„å®é™…é¡¹ç›®æƒ…å†µï¼ˆé‡ç‚¹ï¼‰

ä½ çš„ Qt é¡¹ç›®æœ‰ï¼š

* å¯æ‰§è¡Œç¨‹åºï¼ˆQtStartUpApplicationï¼‰
* æ’ä»¶
* modules
* framework
* 3rd é¢„ç¼–è¯‘åº“

å› æ­¤æœ€å¸¸ä½¿ç”¨ï¼š

---

## ğŸŒŸ **å®Œæ•´æ„å»ºå‘½ä»¤**

```
cmake -S . -B build -DCMAKE_BUILD_TYPE=Release
cmake --build build -j
```

---

## ğŸŒŸ **å•ç‹¬æ‰“åŒ… 3rd åº“**

```
cmake --build build --target package_3rd_binaries
```

---

## ğŸŒŸ **å•ç‹¬æ‰“åŒ… runtime**

```
cmake --build build --target package_platform_runtime
```

---

## ğŸŒŸ **åªå®‰è£… runtime + 3rdï¼ˆä¸ç¼–è¯‘ exeï¼‰**

```
cmake -S . -B build/install-only -DCMAKE_BUILD_TYPE=Release
cmake --install build/install-only --prefix deploy/
```

---

# ğŸŸ© å¦‚æœä½ å‘Šè¯‰æˆ‘ä½ çš„ç¼–è¯‘å™¨ï¼ˆgccï¼Ÿclangï¼ŸMSVCï¼Ÿï¼‰å’Œç³»ç»Ÿï¼ˆUbuntu? Windows?ï¼‰

æˆ‘å¯ä»¥ç»™ä½ ä¸€å¥— **å®Œå…¨é€‚é…ä½ é¡¹ç›®çš„ CMake æ„å»ºæµç¨‹æ¨¡æ¿**ã€‚

å¹¶ä¸”å¯ä»¥ç»“åˆä½ å·¥ç¨‹çš„ CMakeLists.txtï¼š

* è‡ªåŠ¨åŒºåˆ† Debug / Release è¾“å‡ºç›®å½•
* è‡ªåŠ¨æ‹·è´ Qt runtime
* è‡ªåŠ¨æ‰“åŒ… 3rd åº“
* è‡ªåŠ¨å®‰è£…åˆ°ç»Ÿä¸€ deploy ç›®å½•

éšæ—¶å‘Šè¯‰æˆ‘å³å¯ï¼
