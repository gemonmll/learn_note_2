ä¸‹é¢æˆ‘ç»™ä½ å†™ä¸€ä¸ª **å®Œæ•´å¯ç¼–è¯‘çš„ RTTR Demo ç¨‹åº**ï¼ŒåŒ…å«ï¼š

âœ” å¯ç›´æ¥ CMake æ„å»º
âœ” ç±»æ³¨å†Œï¼ˆå±æ€§ã€æ–¹æ³•ã€æ„é€ ï¼‰
âœ” åŠ¨æ€åå°„è°ƒç”¨
âœ” JSON è‡ªåŠ¨èµ‹å€¼ï¼ˆé…ç½®åŠ è½½ï¼‰
âœ” æ¨¡å—æ’ä»¶æœºåˆ¶

éå¸¸é€‚åˆä½ ä½œä¸º **è‡ªåŠ¨é©¾é©¶ç®—æ³•å·¥å…·æ¡†æ¶çš„æ¨¡æ¿**ã€‚

---

# ğŸ“ ç›®å½•ç»“æ„ï¼ˆä½ ç…§ç€åˆ›å»ºï¼‰

```
rttr_demo/
â”‚â”€â”€ CMakeLists.txt
â”‚â”€â”€ main.cpp
â”‚â”€â”€ module.hpp
â”‚â”€â”€ module.cpp
â”‚â”€â”€ config.hpp
â”‚â”€â”€ config.cpp
```

---

# ğŸ“Œ CMakeLists.txt

```cmake
cmake_minimum_required(VERSION 3.10)
project(rttr_demo)

set(CMAKE_CXX_STANDARD 17)

find_package(rttr REQUIRED)
find_package(nlohmann_json REQUIRED)

add_executable(rttr_demo
    main.cpp
    module.cpp
    config.cpp
)

target_link_libraries(rttr_demo PRIVATE
    rttr::rttr_core
    nlohmann_json::nlohmann_json
)
```

> âš ï¸ éœ€è¦å®‰è£…ï¼š

```bash
sudo apt install librttr-dev
sudo apt install nlohmann-json3-dev
```

---

# ğŸ§© module.hppï¼ˆæ’ä»¶æ¨¡å—åŸºç±» + æ´¾ç”Ÿç±»ï¼‰

```cpp
#pragma once
#include <rttr/registration>
#include <iostream>

class IModule
{
public:
    virtual void run() = 0;
    virtual ~IModule() = default;

    RTTR_ENABLE()
};

class AEBModule : public IModule
{
public:
    void run() override
    {
        std::cout << "[AEB] Emergency braking running...\n";
    }

    RTTR_ENABLE(IModule)
};

class LKAModule : public IModule
{
public:
    void run() override
    {
        std::cout << "[LKA] Lane keeping assist running...\n";
    }

    RTTR_ENABLE(IModule)
};
```

---

# ğŸ§© module.cppï¼ˆRTTR æ³¨å†Œï¼‰

```cpp
#include "module.hpp"
#include <rttr/registration>

RTTR_REGISTRATION
{
    rttr::registration::class_<IModule>("IModule");

    rttr::registration::class_<AEBModule>("AEBModule")
        .constructor<>()
        .method("run", &AEBModule::run)
        .RTTR_ENABLE(IModule);

    rttr::registration::class_<LKAModule>("LKAModule")
        .constructor<>()
        .method("run", &LKAModule::run)
        .RTTR_ENABLE(IModule);
}
```

---

# ğŸ§© config.hppï¼ˆç®—æ³•é…ç½®ç±»ï¼‰

```cpp
#pragma once
#include <rttr/registration>
#include <string>

class AEBConfig
{
public:
    float brake_threshold = 0.5f;
    int enable = 1;
    std::string mode = "normal";

    RTTR_ENABLE()
};
```

---

# ğŸ§© config.cppï¼ˆé…ç½®ç±»æ³¨å†Œï¼‰

```cpp
#include "config.hpp"
#include <rttr/registration>

RTTR_REGISTRATION
{
    rttr::registration::class_<AEBConfig>("AEBConfig")
        .property("brake_threshold", &AEBConfig::brake_threshold)
        .property("enable", &AEBConfig::enable)
        .property("mode", &AEBConfig::mode);
}
```

---

# ğŸ§© main.cppï¼ˆå®Œæ•´ Demoï¼‰

```cpp
#include <iostream>
#include <rttr/registration>
#include <rttr/type>
#include <nlohmann/json.hpp>

#include "module.hpp"
#include "config.hpp"

using json = nlohmann::json;

// JSON è‡ªåŠ¨èµ‹å€¼å‡½æ•°
template<typename T>
void load_from_json(T& obj, const json& j)
{
    rttr::instance inst = obj;
    rttr::type t = rttr::type::get(obj);

    for (auto prop : t.get_properties())
    {
        std::string name = prop.get_name().to_string();

        if (j.contains(name))
        {
            prop.set_value(inst, j[name]);
        }
    }
}

int main()
{
    std::cout << "==== RTTR Demo Start ====\n";

    // 1. åå°„æ„é€ æ¨¡å—å¯¹è±¡ï¼ˆæ’ä»¶æœºåˆ¶ï¼‰
    std::string module_name = "AEBModule";
    rttr::type mod_type = rttr::type::get_by_name(module_name);

    if (!mod_type.is_valid())
    {
        std::cout << "Module not found!\n";
        return 0;
    }

    rttr::variant mod_var = mod_type.create();
    IModule* module = mod_var.get_value<IModule*>();

    std::cout << "Running module: " << module_name << std::endl;
    module->run();

    // 2. é…ç½® JSON â†’ è‡ªåŠ¨èµ‹å€¼
    json cfg_json = {
        {"brake_threshold", 0.75},
        {"enable", 1},
        {"mode", "sport"}
    };

    AEBConfig cfg;
    load_from_json(cfg, cfg_json);

    std::cout << "\nLoaded Config:\n";
    std::cout << "  brake_threshold = " << cfg.brake_threshold << "\n";
    std::cout << "  enable = " << cfg.enable << "\n";
    std::cout << "  mode = " << cfg.mode << "\n";

    std::cout << "\n==== Demo End ====\n";
    return 0;
}
```

---

# â–¶ï¸ ç¼–è¯‘è¿è¡Œ

```bash
mkdir build && cd build
cmake ..
make
./rttr_demo
```

---

# âœ”ï¸ è¾“å‡ºç¤ºä¾‹

```
==== RTTR Demo Start ====
Running module: AEBModule
[AEB] Emergency braking running...

Loaded Config:
  brake_threshold = 0.75
  enable = 1
  mode = sport

==== Demo End ====
```

---

# ğŸ ä½ å·²ç»å¾—åˆ°ä¸€ä¸ªå¯ç”¨çš„ RTTR é¡¹ç›®æ¨¡æ¿

å®ƒåŒ…å«ï¼š

âœ” æ¨¡å—æ’ä»¶æœºåˆ¶ï¼ˆè‡ªåŠ¨é©¾é©¶ç®—æ³•é€‚é…ï¼‰
âœ” JSON è‡ªåŠ¨é…ç½®åŠ è½½ï¼ˆå‚æ•°è°ƒè¯•å¿…å¤‡ï¼‰
âœ” å®Œæ•´åå°„æ³¨å†Œç¤ºä¾‹
âœ” CMake å¯ç›´æ¥è¿è¡Œ

ä½ å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ‰©å±•ï¼š

* è‡ªåŠ¨ç”Ÿæˆ GUI è°ƒå‚å·¥å…·ï¼ˆåŸºäº RTTR å±æ€§ï¼‰
* è¿è¡Œæ—¶åˆ‡æ¢ç®—æ³•æ¨¡å—
* è‡ªåŠ¨åºåˆ—åŒ–æ—¥å¿—æ ¼å¼
* å°† RTTR é…ç½®ç”¨äºä»¿çœŸå·¥å…· / ECU ä¸Šä½æœº

---

# éœ€è¦æˆ‘ç»§ç»­å‡çº§ Demo å—ï¼Ÿ

ä½ å¯ä»¥é€‰æ‹©ä¸€ä¸ªæ–¹å‘ï¼Œæˆ‘ç»§ç»­ç»™ä½ å†™å¯¹åº”çš„é«˜çº§ç‰ˆæœ¬ï¼š

1ï¸âƒ£ **è‡ªåŠ¨ç”Ÿæˆ JSONï¼ˆåºåˆ—åŒ–ï¼‰**
2ï¸âƒ£ **æ’ä»¶åŠ¨æ€åŠ è½½ï¼ˆ.so çœŸå®æ’ä»¶ï¼‰**
3ï¸âƒ£ **åå°„ + IMGUI å®æ—¶è°ƒå‚ç•Œé¢**
4ï¸âƒ£ **åå°„ + ROS2 å‚æ•°ç³»ç»Ÿ**
5ï¸âƒ£ **ç®—æ³•æ¨¡å—æ³¨å†Œä¸­å¿ƒï¼ˆç±»ä¼¼ Apollo Cyber RT æ¡†æ¶ï¼‰**

ä½ æƒ³ç»§ç»­å“ªä¸ªï¼Ÿ
