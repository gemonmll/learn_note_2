明确告诉你：

### **❌ 不会！什么也不加，.h 里的内容并不会全部导出。**

即使你什么导出宏（`Q_DECL_EXPORT`）都不写，
即使头文件写了一堆类、函数、全局变量……

**动态库 (.so) 实际上只会导出极少数符号（默认可见性），跟 .h 完全没有关系。**

---

# 🔥 **简单一句话：**

> **头文件 (.h) 不决定符号是否导出，导出只由编译器的 symbol visibility 决定。**

---

# 📌 先回答你的核心问题：

## ❓**如果什么也不加（不写 Q_DECL_EXPORT），.h 里的东西会不会全部导出？**

### **答案：不会，甚至大部分不会导出。**

默认行为如下：

---

# 📥 **（1）Linux / GCC / Clang 默认行为**

默认规则：

| 类型                      | 是否自动导出？                      |
| ----------------------- | ---------------------------- |
| **普通函数**                | ✔ 会导出（默认 visibility=default） |
| **非模板类**                | ✔ 类符号会导出（构造、虚表）              |
| **类成员函数**               | ✔ 常常导出 **但不保证全部导出**          |
| **静态函数 / 匿名 namespace** | ❌ 永远不会导出                     |
| **模板函数/类**              | ❌ 未实例化不会导出                   |
| **内联函数 inline**         | ❌ 通常不会导出                     |

👉 所以 **有一些类会导出，但不是头文件里所有东西都会导出**。

---

# 🪟 **（2）Windows（MSVC） 默认行为**

Windows DLL

### ➤ **没有 `__declspec(dllexport)`，类和函数根本不会导出！**

也就是说：

```
class A {};
void f();
```

在 Windows 上：

👉 **不加 export = 完全不会导出**

（和 Linux 完全不一样）

这也是为什么 Qt 需要 `Q_DECL_EXPORT` 来统一行为。

---

# 🧪 给你一个实际例子

example.h：

```cpp
class A {
public:
    void foo();
};

class B {
public:
    void bar();
};

int add(int x, int y);
```

example.cpp：

```cpp
#include "example.h"

void A::foo() {}
void B::bar() {}
int add(int x, int y) { return x + y; }
```

编译成 libexample.so 后运行：

```
nm -D libexample.so
```

可能看到：

```
00000000000011b0 T add
0000000000001180 T _ZN1A3fooEv
0000000000001140 T _ZN1BC1Ev
0000000000001150 T _ZN1B3barEv
```

你会看到：

* **add 导出**
* **A::foo 导出**
* **B 导出**

但：

* inline 函数不会出现
* static 函数不会出现
* 匿名 namespace 函数不会出现
* 未用到的模板不会出现

这说明：

### ❗头文件里的东西 ≠ 导出的东西

它只决定“能不能被别的文件 include”，
但不决定“是否导出到 .so”。

---

# 🎯 **为什么不要依赖默认导出？**

因为：

* Windows 默认不导出内容（必须指定）
* Linux 默认导出太多内容，符号表巨大
* 你本意只是公开 API，不想把内部函数暴露出去
* 默认导出可能导致符号冲突（尤其在 C++ 名字修饰的情况下）

所以 Qt、CMake 都推荐：

### **显式控制导出，只导出 API 界面**

隐藏内部实现。

---

# 📌 最终总结

| 情况               | 是否导出 .h 中内容？           |
| ---------------- | ---------------------- |
| Linux 默认         | ❌ 不全部导出，导出部分           |
| Windows 默认       | ❌ 几乎一个也不导出             |
| 使用 Q_DECL_EXPORT | ✔ 你指定的东西才导出            |
| 不加任何东西           | ❌ 头文件里的内容不会全部出现在 .so 中 |

---

# 📦 要不要我给你提供：

✔ **一个对比示例：加/不加 Q_DECL_EXPORT 的导出差异**
✔ **演示用 nm / objdump 观察导出符号**
✔ **一个实际插件工程例子（含 CreatePlugin 工厂）**

你想看哪一种？
