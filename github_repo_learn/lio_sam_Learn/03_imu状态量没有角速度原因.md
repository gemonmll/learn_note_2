在 **LIO-SAM**（以及几乎所有基于 IMU 预积分的 VIO/LIO 系统）里，**状态量 X(t) 中确实不包含 “角速度 ω”**，这是完全正常的设计。原因如下：

---

# ✅ **为什么状态向量里没有角速度 ω？**

因为 **角速度并不是状态（state）**，而是 **IMU 的直接测量量**，用于驱动姿态更新。

在连续时间 IMU 动力学模型中：

### **IMU 测量模型**

[
\omega_m = \omega + b_g + n_g
]
[
a_m = R^\top ( \dot v - g ) + b_a + n_a
]

这里：

* **ω**：机体真实角速度（非状态）
* **ω_m**：陀螺仪测量
* **b_g**：陀螺仪 bias（是状态）
* **n_g**：噪声

你可以看到：

👉 系统根本不需要把 **角速度 ω 当成状态求解**，因为：

### **角速度可以通过陀螺仪直接获得，无需估计**

相比之下：

* 姿态 **R** 需要估计
* 位置 **p** 需要估计
* 速度 **v** 需要估计
* 偏置 **b_g, b_a** 必须估计（慢变、影响积分）

而：

* **角速度 ω 是瞬时量，IMU 每次测量都可以直接提供**

所以不需要放入状态向量里！

---

# ✅ LIO-SAM 的 IMU 状态为什么只有这些？

LIO-SAM 使用的状态向量（与 GTSAM IMU preintegration 相同）：

[
X = { R, p, v, b_a, b_g }
]

这是 **Forster 2017** IMU 预积分模型（GTSAM IMU）的标准格式。

原因：

### **1. 角速度用于“更新姿态”，不是状态**

姿态的微分方程：

[
\dot R = R (\omega_m - b_g - n_g)^\wedge
]

这里直接用测量的角速度更新即可，因此 ω 不作为状态。

---

### **2. IMU bias 才是需要优化的部分**

系统长期漂移主要由偏置导致，因此必须估计：

* **b_g（陀螺偏置）**
* **b_a（加速度计偏置）**

角速度本身不需要估计，只是用测量值减掉偏置即可。

---

### **3. 加入角速度会使状态维数变大，不必要**

如果 X 中包含角速度：

* 状态维度增加 3
* 但没有新的信息约束它（IMU 已包含测量）

这会：

✔ 提高计算负担
✔ 降低滤波/优化条件数
✘ 完全没有必要

因此，不会加入角速度。

---

# ✅ LIO-SAM 如何使用角速度？

虽然不在状态中，但 LIO-SAM 在每一步使用角速度更新：

1. 从 IMU 读取 ω_m
2. 减去 bias
3. 用预积分模型更新姿态

例如伪代码：

```cpp
gyro = imu->angular_velocity - bias.gyro;
deltaR = Exp( gyro * dt );
R = R * deltaR;
```

所以：

👉 **角速度被使用，但不是状态**
👉 **bias 是状态，因为系统需要估计它**

---

# ⭐ 总结：为什么 LIO-SAM 不把角速度放入状态？**

| 项目       | 是否在状态 | 原因               |
| -------- | ----- | ---------------- |
| 姿态 R     | ✔     | 需要长期估计           |
| 位置 p     | ✔     | 需要长期估计           |
| 速度 v     | ✔     | 需要长期估计           |
| 陀螺偏置 b_g | ✔     | 影响积分，必须估计        |
| 加计偏置 b_a | ✔     | 影响积分，必须估计        |
| 角速度 ω    | ❌     | 由 IMU 直接测量，不需要估计 |

---

# 如果你愿意，我可以继续帮你：

### ✔ 画出 LIO-SAM IMU 状态转移图

### ✔ 详细解释 IMU 预积分为什么不需要 ω

### ✔ 帮你推导 IMU 连续时间积分模型

### ✔ 给你比对 LIO-SAM、VINS-Mono、GTSAM 状态向量的区别

你想继续深入哪一块？
