éå¸¸å¥½çš„é—®é¢˜ï¼ç†è§£ **é¢„ç§¯åˆ†ï¼ˆPreintegrationï¼‰** æ˜¯æ·±å…¥ç†è§£ **LIO-SAM**ï¼ˆæˆ– VINSã€OKVISã€GTSAM ç­‰ï¼‰ä¸­ **IMUå› å­ï¼ˆIMU Factorï¼‰** çš„å…³é”®ã€‚ä¸‹é¢æˆ‘ä¼šä» **åŸç† â†’ æ•°å­¦æ¨å¯¼ â†’ åœ¨LIO-SAMä¸­çš„ä½œç”¨** ä¸‰ä¸ªå±‚æ¬¡å¸®ä½ å½»åº•è®²æ¸…æ¥šã€‚

---

## ğŸ§­ ä¸€ã€é—®é¢˜èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆè¦â€œé¢„ç§¯åˆ†â€ï¼Ÿ

åœ¨ LIO-SAM ä¸­ï¼Œæˆ‘ä»¬èåˆ **æ¿€å…‰é‡Œç¨‹è®¡ï¼ˆLiDAR Odometryï¼‰** ä¸ **IMUæµ‹é‡ï¼ˆæƒ¯å¯¼ï¼‰**ã€‚IMU çš„æ•°æ®é¢‘ç‡éå¸¸é«˜ï¼ˆå‡ ç™¾ Hzï¼‰ï¼Œè€Œæ¿€å…‰å¸§é¢‘ç‡ä½ï¼ˆæ¯”å¦‚ 10Hzï¼‰ã€‚

å‡è®¾ï¼š

* æ¯ä¸ªæ¿€å…‰å¸§ä¹‹é—´é—´éš” ( \Delta t \approx 0.1s )
* æœŸé—´æœ‰ä¸Šç™¾ä¸ª IMU æµ‹é‡

å¦‚æœæ¯æ¬¡ä¼˜åŒ–éƒ½æŠŠè¿™ä¸Šç™¾ä¸ª IMU æµ‹é‡å•ç‹¬æ”¾è¿›ä¼˜åŒ–ä¸­ï¼ˆå³ç›´æ¥ç§¯åˆ†ï¼‰ï¼Œä»£ä»·å¤ªå¤§ã€‚å› æ­¤æˆ‘ä»¬å¸Œæœ›ï¼š

> åœ¨ä¸¤å¸§ä¹‹é—´ï¼ŒæŠŠæ‰€æœ‰çš„ IMU æµ‹é‡â€œå‹ç¼©â€æˆä¸€ä¸ªç­‰ä»·çš„çº¦æŸã€‚

è¿™ç§â€œå‹ç¼©ç§¯åˆ†â€çš„è¿‡ç¨‹ï¼Œå°±å« **IMUé¢„ç§¯åˆ†ï¼ˆIMU Preintegrationï¼‰**ã€‚

---

## âš™ï¸ äºŒã€ä»åŸç†ç†è§£ï¼šIMUæµ‹é‡çš„ç§¯åˆ†æ¨¡å‹

IMUç»™æˆ‘ä»¬ä¸¤ä¸ªæ ¸å¿ƒè§‚æµ‹ï¼š

[
\begin{cases}
\tilde{\mathbf{a}}_t = \mathbf{R}_t^T (\mathbf{a}_t - \mathbf{g}) + \mathbf{b}_a + \mathbf{n}_a \
\tilde{\boldsymbol{\omega}}_t = \boldsymbol{\omega}_t + \mathbf{b}_g + \mathbf{n}_g
\end{cases}
]

å…¶ä¸­ï¼š

* (\tilde{\mathbf{a}}_t)ï¼šIMUæµ‹å¾—çš„åŠ é€Ÿåº¦ï¼ˆå«å™ªå£°ä¸åç½®ï¼‰
* (\tilde{\boldsymbol{\omega}}_t)ï¼šIMUæµ‹å¾—çš„è§’é€Ÿåº¦
* (\mathbf{R}_t)ï¼šä¸–ç•Œç³»åˆ°IMUç³»çš„æ—‹è½¬çŸ©é˜µ
* (\mathbf{g})ï¼šé‡åŠ›
* (\mathbf{b}_a, \mathbf{b}_g)ï¼šåŠ é€Ÿåº¦è®¡å’Œé™€èºä»ªåç½®

ç‰©ç†è¿åŠ¨æ¨¡å‹ä¸ºï¼š

[
\begin{cases}
\dot{\mathbf{p}}_t = \mathbf{v}_t \
\dot{\mathbf{v}}_t = \mathbf{R}_t (\tilde{\mathbf{a}}_t - \mathbf{b}_a - \mathbf{n}_a) + \mathbf{g} \
\dot{\mathbf{R}}_t = \mathbf{R}_t \left[ \tilde{\boldsymbol{\omega}}_t - \mathbf{b}_g - \mathbf{n}*g \right]*\times
\end{cases}
]

å¦‚æœæˆ‘ä»¬æƒ³ä»æ—¶åˆ» (i) ç§¯åˆ†åˆ°æ—¶åˆ» (j)ï¼Œå¯ä»¥å¾—åˆ°ï¼š

[
\begin{cases}
\mathbf{R}_j = \mathbf{R}*i \prod*{k=i}^{j-1} \exp\left( (\tilde{\boldsymbol{\omega}}_k - \mathbf{b}_g)\Delta t \right) \
\mathbf{v}*j = \mathbf{v}*i + \mathbf{g}\Delta t*{ij} + \mathbf{R}*i \sum*{k=i}^{j-1} \mathbf{R}*{ik} (\tilde{\mathbf{a}}_k - \mathbf{b}_a)\Delta t \
\mathbf{p}*j = \mathbf{p}*i + \mathbf{v}*i\Delta t*{ij} + \frac{1}{2}\mathbf{g}\Delta t*{ij}^2 + \mathbf{R}*i \sum*{k=i}^{j-1} \mathbf{R}*{ik} \Delta \mathbf{p}_k
\end{cases}
]

ä½†æ˜¯è¿™ä¸ªç§¯åˆ†ä¾èµ–äº **å§¿æ€å˜åŒ–**ï¼Œè€Œå§¿æ€æœ¬èº«åˆæ˜¯ç§¯åˆ†å‡ºæ¥çš„ï¼è¿™æ„å‘³ç€æ¯æ¬¡ä¼˜åŒ–å§¿æ€å˜åŒ–æ—¶ï¼Œéƒ½å¾—é‡æ–°è®¡ç®—æ•´ä¸ªç§¯åˆ† â†’ è®¡ç®—é‡å·¨å¤§ã€‚

---

## ğŸ’¡ ä¸‰ã€é¢„ç§¯åˆ†æ€æƒ³ï¼šæ¢å‚è€ƒç³»ç®€åŒ–è®¡ç®—

è§£å†³æ€è·¯ï¼š
æˆ‘ä»¬å¸Œæœ›æŠŠç§¯åˆ†æ”¾åˆ°ä¸€ä¸ªå›ºå®šå‚è€ƒç³»ä¸‹ï¼ˆé€šå¸¸æ˜¯èµ·å§‹å¸§ (i) çš„IMUåæ ‡ç³»ï¼‰ï¼Œè¿™æ ·åœ¨ä¼˜åŒ–æ—¶å°±ä¸å¿…æ¯æ¬¡é‡æ–°ç§¯åˆ†ã€‚

### å®šä¹‰â€œé¢„ç§¯åˆ†é‡â€

æˆ‘ä»¬å®šä¹‰ä¸‰ä¸ªé¢„ç§¯åˆ†å˜é‡ï¼š

[
\begin{cases}
\Delta \mathbf{R}_{ij} = \mathbf{R}_i^T \mathbf{R}*j \
\Delta \mathbf{v}*{ij} = \mathbf{R}_i^T (\mathbf{v}*j - \mathbf{v}*i - \mathbf{g}\Delta t*{ij}) \
\Delta \mathbf{p}*{ij} = \mathbf{R}_i^T (\mathbf{p}_j - \mathbf{p}*i - \mathbf{v}*i\Delta t*{ij} - \frac{1}{2}\mathbf{g}\Delta t*{ij}^2)
\end{cases}
]

è¿™äº›é‡å…¨éƒ¨å®šä¹‰åœ¨ **èµ·å§‹IMUåæ ‡ç³» (i)** ä¸‹ï¼Œä¾èµ–äºIMUæµ‹é‡çš„ç§¯åˆ†ã€‚

äºæ˜¯ç§¯åˆ†æ–¹ç¨‹è½¬åŒ–ä¸ºï¼š

[
\begin{cases}
\mathbf{R}_j = \mathbf{R}*i \Delta \mathbf{R}*{ij} \
\mathbf{v}_j = \mathbf{v}*i + \mathbf{g}\Delta t*{ij} + \mathbf{R}*i \Delta \mathbf{v}*{ij} \
\mathbf{p}_j = \mathbf{p}*i + \mathbf{v}*i\Delta t*{ij} + \frac{1}{2}\mathbf{g}\Delta t*{ij}^2 + \mathbf{R}*i \Delta \mathbf{p}*{ij}
\end{cases}
]

---

## ğŸ§® å››ã€å¦‚ä½•è®¡ç®—é¢„ç§¯åˆ†é‡

åœ¨æ—¶é—´ä¸Šç¦»æ•£åŒ–ç§¯åˆ†ï¼Œç»™å®šæ¯ä¸ªæ—¶é—´é—´éš” (\Delta t_k)ï¼š

[
\begin{cases}
\Delta \mathbf{R}_{k+1} = \Delta \mathbf{R}_k \exp((\tilde{\boldsymbol{\omega}}_k - \mathbf{b}*g)\Delta t_k) \
\Delta \mathbf{v}*{k+1} = \Delta \mathbf{v}_k + \Delta \mathbf{R}_k (\tilde{\mathbf{a}}_k - \mathbf{b}*a)\Delta t_k \
\Delta \mathbf{p}*{k+1} = \Delta \mathbf{p}_k + \Delta \mathbf{v}_k\Delta t_k + \frac{1}{2}\Delta \mathbf{R}_k (\tilde{\mathbf{a}}_k - \mathbf{b}_a)\Delta t_k^2
\end{cases}
]

è¿™äº›ç§¯åˆ†ç»“æœå¯ä»¥é¢„å…ˆè®¡ç®—ï¼ˆåœ¨ä¼˜åŒ–å‰ç¦»çº¿ç®—å¥½ï¼‰ã€‚
ä¹‹ååœ¨ä¼˜åŒ–æ—¶ï¼Œå¦‚æœ bias å‘ç”Ÿäº†å°å˜åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ **ä¸€é˜¶ä¿®æ­£å…¬å¼**ï¼ˆGTSAMé‡Œæœ‰è§£æé›…å¯æ¯”ï¼‰æ¥å¿«é€Ÿæ›´æ–°é¢„ç§¯åˆ†ç»“æœã€‚

---

## ğŸ§± äº”ã€åœ¨LIO-SAM/GTSAMä¸­çš„ä½œç”¨

åœ¨å› å­å›¾ï¼ˆFactor Graphï¼‰ä¸­ï¼ŒIMUå› å­è¿æ¥ä¸¤å¸§ï¼ˆstate i å’Œ state jï¼‰ï¼š

[
\text{IMU Factor: } \quad \mathbf{z}*{ij}^{IMU} = (\Delta \mathbf{R}*{ij}, \Delta \mathbf{v}*{ij}, \Delta \mathbf{p}*{ij})
]

å®ƒçš„æ®‹å·®å®šä¹‰ä¸ºï¼š

[
\mathbf{r}*{IMU} =
\begin{bmatrix}
\text{Log}(\Delta \mathbf{R}*{ij}^{T} (\mathbf{R}_i^T \mathbf{R}_j)) \
\mathbf{R}_i^T (\mathbf{v}*j - \mathbf{v}*i - \mathbf{g}\Delta t*{ij}) - \Delta \mathbf{v}*{ij} \
\mathbf{R}_i^T (\mathbf{p}*j - \mathbf{p}*i - \mathbf{v}*i\Delta t*{ij} - \frac{1}{2}\mathbf{g}\Delta t*{ij}^2) - \Delta \mathbf{p}*{ij}
\end{bmatrix}
]

å®ƒçº¦æŸäº†ç›¸é‚»ä¸¤ä¸ªå§¿æ€ã€é€Ÿåº¦å’Œä½ç½®ä¹‹é—´çš„å…³ç³»ã€‚

---

## ğŸ“š å…­ã€æ€»ç»“ä¸€å¥è¯

> **IMUé¢„ç§¯åˆ†** å°±æ˜¯æŠŠè¿ç»­é«˜é¢‘çš„IMUæµ‹é‡ï¼Œæ•´åˆæˆä¸€ä¸ªæè¿°â€œç›¸å¯¹è¿åŠ¨â€çš„å°åŒ…ï¼ˆÎ”R, Î”v, Î”pï¼‰ï¼Œ
> å¹¶ä¸”åœ¨èµ·å§‹åæ ‡ç³»ä¸‹è¡¨è¾¾ï¼Œè¿™æ ·ä¼˜åŒ–æ—¶ä¸ç”¨æ¯æ¬¡é‡æ–°ç§¯åˆ†ï¼Œå¤§å¹…æé«˜æ•ˆç‡ã€‚

---

## ğŸ§  è¡¥å……ç›´è§‰ç†è§£

| å¯¹æ¯”  | ä¼ ç»Ÿç§¯åˆ†       | é¢„ç§¯åˆ†       |
| --- | ---------- | --------- |
| å‚è€ƒç³» | ä¸–ç•Œç³»        | èµ·å§‹å¸§IMUç³»   |
| ä¾èµ–é‡ | å½“å‰å§¿æ€ã€é€Ÿåº¦ã€é‡åŠ› | èµ·å§‹çŠ¶æ€å›ºå®š    |
| ä¼˜åŒ–æ—¶ | æ¯æ¬¡é‡æ–°ç§¯åˆ†     | ä»…ç”¨é›…å¯æ¯”çº¿æ€§ä¿®æ­£ |
| è®¡ç®—é‡ | é«˜          | ä½ï¼ˆæ•°åå€åŠ é€Ÿï¼‰  |

---

å¦‚æœä½ æƒ³ï¼Œæˆ‘å¯ä»¥ï¼š

1. ç»™å‡º **é¢„ç§¯åˆ†åœ¨GTSAMä¸­çš„C++ä»£ç è·¯å¾„**ï¼ˆLIO-SAMä½¿ç”¨çš„é‚£ä¸ªç±»ï¼‰ï¼›
2. æˆ–è€…æ¨ä¸€éå®ƒçš„ **ä¸€é˜¶ä¿®æ­£å…¬å¼**ï¼ˆå¯¹ bias çš„çº¿æ€§åŒ–è¡¥å¿ï¼‰ï¼›
3. æˆ–ç”»å‡ºä¸€å¼  **é¢„ç§¯åˆ†åœ¨å› å­å›¾ä¸­çš„ç¤ºæ„å›¾**ã€‚

ä½ å¸Œæœ›æˆ‘æ¥ä¸‹æ¥å¸®ä½ è®²å“ªä¸€éƒ¨åˆ†ï¼Ÿ

% IMU measurement model
\tilde{\mathbf{a}}_t = \mathbf{R}_t^\top (\mathbf{a}_t - \mathbf{g}) + \mathbf{b}_a + \mathbf{n}_a
\qquad
\tilde{\boldsymbol{\omega}}_t = \boldsymbol{\omega}_t + \mathbf{b}_g + \mathbf{n}_g

% Continuous-time motion model
\dot{\mathbf{p}}_t = \mathbf{v}_t
\qquad
\dot{\mathbf{v}}_t = \mathbf{R}_t(\tilde{\mathbf{a}}_t - \mathbf{b}_a - \mathbf{n}_a) + \mathbf{g}
\qquad
\dot{\mathbf{R}}_t = \mathbf{R}_t [\tilde{\boldsymbol{\omega}}_t - \mathbf{b}_g - \mathbf{n}_g]_\times

% Preintegration definitions (expressed in frame i)
\Delta\mathbf{R}_{ij} = \mathbf{R}_i^\top \mathbf{R}_j

\Delta\mathbf{v}_{ij} = \mathbf{R}_i^\top\big(\mathbf{v}_j - \mathbf{v}_i - \mathbf{g}\Delta t_{ij}\big)

\Delta\mathbf{p}_{ij} = \mathbf{R}_i^\top\big(\mathbf{p}_j - \mathbf{p}_i - \mathbf{v}_i\Delta t_{ij} - \tfrac{1}{2}\mathbf{g}\Delta t_{ij}^2\big)

% Discrete update (per IMU sample k)
\Delta\mathbf{R}_{k+1} = \Delta\mathbf{R}_{k}\,\exp\big((\tilde{\boldsymbol{\omega}}_k - \mathbf{b}_g)\Delta t_k\big)

\Delta\mathbf{v}_{k+1} = \Delta\mathbf{v}_{k} + \Delta\mathbf{R}_{k}(\tilde{\mathbf{a}}_k - \mathbf{b}_a)\Delta t_k

\Delta\mathbf{p}_{k+1} = \Delta\mathbf{p}_{k} + \Delta\mathbf{v}_{k}\Delta t_k + \tfrac{1}{2}\Delta\mathbf{R}_{k}(\tilde{\mathbf{a}}_k - \mathbf{b}_a)\Delta t_k^2

% IMU factor residuals
\mathbf{r}_{rot} = \mathrm{Log}\big(\Delta\mathbf{R}_{ij}^\top (\mathbf{R}_i^\top \mathbf{R}_j)\big)

\mathbf{r}_{vel} = \mathbf{R}_i^\top(\mathbf{v}_j - \mathbf{v}_i - \mathbf{g}\Delta t_{ij}) - \Delta\mathbf{v}_{ij}

\mathbf{r}_{pos} = \mathbf{R}_i^\top(\mathbf{p}_j - \mathbf{p}_i - \mathbf{v}_i\Delta t_{ij} - \tfrac{1}{2}\mathbf{g}\Delta t_{ij}^2) - \Delta\mathbf{p}_{ij}
